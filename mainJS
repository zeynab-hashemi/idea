        let currentUser = null;
        let currentUserType = null;
        let loginAttempts = 0;
        const maxLoginAttempts = 3;
        
        // Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…Ø­Ù„ÛŒ (Ø¯Ø± Ù¾Ø±ÙˆÚ˜Ù‡ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² Ø³Ø±ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
        // Ø­ÙØ¸ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‚Ø¨Ù„ÛŒ Ø¯Ø± ØµÙˆØ±Øª ÙˆØ¬ÙˆØ¯
        let users = JSON.parse(localStorage.getItem('platformUsers'));
        if (!users) {
            users = {
                ideaOwner: [],
                investor: []
            };
            localStorage.setItem('platformUsers', JSON.stringify(users));
        }
        
        function showLoginPage() {
            hideAllPages();
            document.getElementById('loginPage').classList.remove('hidden');
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¬Ù„Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±
            clearUserSession();
        }
        
        function hideAllPages() {
            const pages = ['loginPage', 'authPage', 'ideaOwnerDashboard', 'investorDashboard', 'ideaDetailsPage'];
            pages.forEach(page => {
                document.getElementById(page).classList.add('hidden');
            });
        }
        
        function showAuthPage(userType) {
            currentUserType = userType;
            hideAllPages();
            document.getElementById('authPage').classList.remove('hidden');
            
            const title = document.getElementById('authTitle');
            title.textContent = userType === 'ideaOwner' ? 'ÙˆØ±ÙˆØ¯ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±' : 'ÙˆØ±ÙˆØ¯ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±';
            
            // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ØªÙ„Ø§Ø´â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ùˆ ÙØ±Ù…â€ŒÙ‡Ø§
            loginAttempts = 0;
            clearForms();
            hideError('loginError');
            hideError('registerError');
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ ÙˆØ±ÙˆØ¯
            const loginButton = document.getElementById('loginButton');
            if (loginButton) {
                loginButton.disabled = false;
                loginButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
            
            showLoginForm();
        }
        
        function clearForms() {
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù… ÙˆØ±ÙˆØ¯
            const loginEmail = document.getElementById('loginEmail');
            const loginPassword = document.getElementById('loginPassword');
            if (loginEmail) loginEmail.value = '';
            if (loginPassword) loginPassword.value = '';
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
            const registerName = document.getElementById('registerName');
            const registerEmail = document.getElementById('registerEmail');
            const registerPassword = document.getElementById('registerPassword');
            const registerConfirmPassword = document.getElementById('registerConfirmPassword');
            if (registerName) registerName.value = '';
            if (registerEmail) registerEmail.value = '';
            if (registerPassword) registerPassword.value = '';
            if (registerConfirmPassword) registerConfirmPassword.value = '';
        }
        
        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }
        
        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }
        
        function showError(errorId, message) {
            const errorDiv = document.getElementById(errorId);
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            
            // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø®Ø·Ø§ Ø¨Ø¹Ø¯ Ø§Ø² 5 Ø«Ø§Ù†ÛŒÙ‡
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }
        
        function hideError(errorId) {
            document.getElementById(errorId).classList.add('hidden');
        }
        
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function processLogin() {
            const email = document.getElementById('loginEmail');
            const password = document.getElementById('loginPassword');
            const loginButton = document.getElementById('loginButton');
            
            if (!email || !password || !loginButton) {
                console.error('Login elements not found');
                return;
            }
            
            const emailValue = email.value.trim();
            const passwordValue = password.value;
            
            hideError('loginError');
            
            // Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´â€ŒÙ‡Ø§
            if (loginAttempts >= maxLoginAttempts) {
                showError('loginError', `âŒ Ø´Ù…Ø§ Ø¨ÛŒØ´ Ø§Ø² ${maxLoginAttempts} Ø¨Ø§Ø± ØªÙ„Ø§Ø´ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ 5 Ø¯Ù‚ÛŒÙ‚Ù‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯.`);
                loginButton.disabled = true;
                loginButton.classList.add('opacity-50', 'cursor-not-allowed');
                
                // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù…Ø¬Ø¯Ø¯ Ø¨Ø¹Ø¯ Ø§Ø² 5 Ø¯Ù‚ÛŒÙ‚Ù‡ (300 Ø«Ø§Ù†ÛŒÙ‡)
                setTimeout(() => {
                    loginAttempts = 0;
                    loginButton.disabled = false;
                    loginButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    hideError('loginError');
                }, 300000); // 5 Ø¯Ù‚ÛŒÙ‚Ù‡
                
                return;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§
            if (!emailValue || !passwordValue) {
                showError('loginError', 'âŒ Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
                return;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ù…Øª Ø§ÛŒÙ…ÛŒÙ„
            if (!validateEmail(emailValue)) {
                showError('loginError', 'âŒ ÙØ±Ù…Øª Ø§ÛŒÙ…ÛŒÙ„ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª');
                return;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
            const userList = users[currentUserType] || [];
            const user = userList.find(u => u.email === emailValue && u.password === passwordValue);
            
            if (user) {
                // ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚
                currentUser = user;
                loginAttempts = 0; // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ØªÙ„Ø§Ø´â€ŒÙ‡Ø§
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¬Ù„Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±
                saveUserSession();
                
                if (currentUserType === 'ideaOwner') {
                    showIdeaOwnerDashboard();
                } else {
                    showInvestorDashboard();
                }
            } else {
                // ÙˆØ±ÙˆØ¯ Ù†Ø§Ù…ÙˆÙÙ‚
                loginAttempts++;
                const remainingAttempts = maxLoginAttempts - loginAttempts;
                
                if (remainingAttempts > 0) {
                    showError('loginError', `âŒ Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª. ${remainingAttempts} ØªÙ„Ø§Ø´ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡`);
                } else {
                    showError('loginError', `âŒ Ø´Ù…Ø§ Ø¨ÛŒØ´ Ø§Ø² ${maxLoginAttempts} Ø¨Ø§Ø± ØªÙ„Ø§Ø´ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ 5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ù…Ø³Ø¯ÙˆØ¯ Ø´Ø¯.`);
                    loginButton.disabled = true;
                    loginButton.classList.add('opacity-50', 'cursor-not-allowed');
                    
                    // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù…Ø¬Ø¯Ø¯ Ø¨Ø¹Ø¯ Ø§Ø² 5 Ø¯Ù‚ÛŒÙ‚Ù‡
                    setTimeout(() => {
                        loginAttempts = 0;
                        loginButton.disabled = false;
                        loginButton.classList.remove('opacity-50', 'cursor-not-allowed');
                        hideError('loginError');
                    }, 300000); // 5 Ø¯Ù‚ÛŒÙ‚Ù‡
                }
            }
        }
        
        function processRegister() {
            const nameEl = document.getElementById('registerName');
            const emailEl = document.getElementById('registerEmail');
            const passwordEl = document.getElementById('registerPassword');
            const confirmPasswordEl = document.getElementById('registerConfirmPassword');
            
            if (!nameEl || !emailEl || !passwordEl || !confirmPasswordEl) {
                console.error('Register elements not found');
                return;
            }
            
            const name = nameEl.value.trim();
            const email = emailEl.value.trim();
            const password = passwordEl.value;
            const confirmPassword = confirmPasswordEl.value;
            
            hideError('registerError');
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§
            if (!name || !email || !password || !confirmPassword) {
                showError('registerError', 'âŒ Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯');
                return;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ù…Øª Ø§ÛŒÙ…ÛŒÙ„
            if (!validateEmail(email)) {
                showError('registerError', 'âŒ ÙØ±Ù…Øª Ø§ÛŒÙ…ÛŒÙ„ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª');
                return;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø·ÙˆÙ„ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
            if (password.length < 6) {
                showError('registerError', 'âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 6 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
                return;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ ØªØ·Ø§Ø¨Ù‚ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
            if (password !== confirmPassword) {
                showError('registerError', 'âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ùˆ ØªÚ©Ø±Ø§Ø± Ø¢Ù† ÛŒÚ©Ø³Ø§Ù† Ù†ÛŒØ³ØªÙ†Ø¯');
                return;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø§ÛŒÙ…ÛŒÙ„ Ø¯Ø± Ø³ÛŒØ³ØªÙ…
            const userList = users[currentUserType] || [];
            const existingUser = userList.find(u => u.email === email);
            
            if (existingUser) {
                showError('registerError', 'âŒ Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª');
                return;
            }
            
            // Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚
            const newUser = { 
                email, 
                password, 
                name,
                id: Date.now().toString(),
                createdAt: new Date().toISOString(),
                profile: {},
                medals: [],
                wallet: { balance: 0, transactions: [] }
            };
            
            // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ Ø¢Ø±Ø§ÛŒÙ‡
            if (!users[currentUserType]) {
                users[currentUserType] = [];
            }
            
            users[currentUserType].push(newUser);
            currentUser = newUser;
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            localStorage.setItem('platformUsers', JSON.stringify(users));
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¬Ù„Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±
            saveUserSession();
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
            const registerErrorEl = document.getElementById('registerError');
            if (registerErrorEl && registerErrorEl.parentNode) {
                const successDiv = document.createElement('div');
                successDiv.className = 'bg-green-600/20 border border-green-500 rounded-lg p-3 text-green-300 text-sm';
                successDiv.textContent = 'âœ… Ø«Ø¨Øªâ€Œ Ù†Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!';
                registerErrorEl.parentNode.insertBefore(successDiv, registerErrorEl);
                
                setTimeout(() => {
                    if (successDiv.parentNode) {
                        successDiv.remove();
                    }
                    if (currentUserType === 'ideaOwner') {
                        showIdeaOwnerDashboard();
                    } else {
                        showInvestorDashboard();
                    }
                }, 2000);
            } else {
                // Ø§Ú¯Ø± element Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ØŒ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø±Ùˆ
                setTimeout(() => {
                    if (currentUserType === 'ideaOwner') {
                        showIdeaOwnerDashboard();
                    } else {
                        showInvestorDashboard();
                    }
                }, 1000);
            }
        }
        

        
        function showIdeaOwnerDashboard() {
            try {
                hideAllPages();
                const dashboard = document.getElementById('ideaOwnerDashboard');
                if (dashboard) {
                    dashboard.classList.remove('hidden');
                }
                
                // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ø±Ø¨Ø±
                if (!currentUser.profile) currentUser.profile = {};
                if (!currentUser.medals) currentUser.medals = [];
                if (!currentUser.wallet) currentUser.wallet = { balance: 0, transactions: [] };
                
                updateUserProfile();
                loadUserIdeas();
                updateMedalsDisplay();
                loadExamField();
                loadIdeaOwnerChats();
                loadIdeaOwnerProjects();
                showIdeaOwnerSection('profile');
            } catch (error) {
                console.error('Error showing idea owner dashboard:', error);
            }
        }
        
        function showInvestorDashboard() {
            try {
                hideAllPages();
                const dashboard = document.getElementById('investorDashboard');
                if (dashboard) {
                    dashboard.classList.remove('hidden');
                }
                
                // Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ Ø³Ø§Ø®ØªØ§Ø± Ú©Ø§Ø±Ø¨Ø±
                if (!currentUser.profile) currentUser.profile = {};
                
                updateInvestorProfile();
                loadAvailableIdeas();
                loadUserInvestments();
                loadEscrowTransactions();
                showInvestorSection('profile');
            } catch (error) {
                console.error('Error showing investor dashboard:', error);
            }
        }
function updateUserProfile() {
            if (!currentUser) return;
            
            try {
                const nameEl = document.getElementById('userProfileName');
                const emailEl = document.getElementById('userProfileEmail');
                const phoneEl = document.getElementById('userProfilePhone');
                const cityEl = document.getElementById('userProfileCity');
                const experienceEl = document.getElementById('userProfileExperience');
                const titleEl = document.getElementById('userProfileTitle');
                const bioEl = document.getElementById('userProfileBio');
                
                if (nameEl) nameEl.textContent = currentUser.name || 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±';
                if (emailEl) emailEl.textContent = currentUser.email || '-';
                
                if (currentUser.profile) {
                    if (phoneEl) phoneEl.textContent = currentUser.profile.phone || '-';
                    if (cityEl) cityEl.textContent = currentUser.profile.city || '-';
                    if (experienceEl) experienceEl.textContent = currentUser.profile.experience ? `${currentUser.profile.experience} Ø³Ø§Ù„` : '-';
                    if (titleEl) titleEl.textContent = currentUser.profile.specialty || 'ØªØ®ØµØµ';
                    if (bioEl) bioEl.textContent = currentUser.profile.bio || 'Ù‡Ù†ÙˆØ² Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.';
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©ÛŒÙ Ù¾ÙˆÙ„
                updateWalletDisplay();
            } catch (error) {
                console.error('Error updating user profile:', error);
            }
        }
        
        function updateWalletDisplay() {
            try {
                if (!currentUser.wallet) {
                    currentUser.wallet = { balance: 0, transactions: [] };
                }
                
                const balance = currentUser.wallet.balance || 0;
                const totalIncome = currentUser.wallet.transactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const balanceEl = document.getElementById('userWalletBalance');
                const incomeEl = document.getElementById('userTotalIncome');
                
                if (balanceEl) balanceEl.textContent = `${balance.toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
                if (incomeEl) incomeEl.textContent = `${totalIncome.toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
            } catch (error) {
                console.error('Error updating wallet display:', error);
            }
        }
        
        function showWalletHistory() {
            if (!currentUser.wallet || !currentUser.wallet.transactions.length) {
                alert('ğŸ“Š ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§\n\nÙ‡Ù†ÙˆØ² ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'walletHistoryModal';
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50';
            
            const transactions = currentUser.wallet.transactions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10); // Ø¢Ø®Ø±ÛŒÙ† 10 ØªØ±Ø§Ú©Ù†Ø´
            
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl p-8 max-w-2xl w-full border border-green-500/30 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-green-300">ğŸ“Š ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</h3>
                        <button onclick="closeWalletHistory()" class="text-gray-400 hover:text-white text-2xl">âœ•</button>
                    </div>
                    
                    <div class="space-y-4">
                        ${transactions.map(transaction => `
                            <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h4 class="font-bold text-white">${transaction.description}</h4>
                                        <p class="text-sm text-gray-400">${new Date(transaction.date).toLocaleDateString('fa-IR')} - ${new Date(transaction.date).toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold ${transaction.type === 'income' ? 'text-green-400' : 'text-red-400'}">
                                            ${transaction.type === 'income' ? '+' : '-'}${transaction.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†
                                        </p>
                                        <p class="text-xs text-gray-400">${transaction.type === 'income' ? 'Ø¯Ø±Ø¢Ù…Ø¯' : 'Ø¨Ø±Ø¯Ø§Ø´Øª'}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="mt-6 text-center">
                        <button onclick="closeWalletHistory()" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg text-white transition-colors">
                            Ø¨Ø³ØªÙ†
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closeWalletHistory() {
            const modal = document.getElementById('walletHistoryModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function updateInvestorProfile() {
            if (!currentUser) return;
            
            try {
                const nameEl = document.getElementById('investorProfileName');
                const emailEl = document.getElementById('investorProfileEmail');
                const phoneEl = document.getElementById('investorProfilePhone');
                const cityEl = document.getElementById('investorProfileCity');
                const budgetEl = document.getElementById('investorProfileBudget');
                const interestsEl = document.getElementById('investorProfileInterests');
                
                if (nameEl) nameEl.textContent = currentUser.name || 'Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±';
                if (emailEl) emailEl.textContent = currentUser.email || '-';
                
                if (currentUser.profile) {
                    if (phoneEl) phoneEl.textContent = currentUser.profile.phone || '-';
                    if (cityEl) cityEl.textContent = currentUser.profile.city || '-';
                    if (budgetEl) budgetEl.textContent = currentUser.profile.budget || '-';
                    if (interestsEl) interestsEl.textContent = currentUser.profile.interests || 'Ù‡Ù†ÙˆØ² Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.';
                }
            } catch (error) {
                console.error('Error updating investor profile:', error);
            }
        }
        
        function showIdeaOwnerSection(section) {
            try {
                // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§
                const sections = ['ideaOwnerProfile', 'ideaOwnerSubmit', 'ideaOwnerIdeas', 'ideaOwnerExams', 'ideaOwnerProjects', 'ideaOwnerChat'];
                sections.forEach(s => {
                    const el = document.getElementById(s);
                    if (el) el.classList.add('hidden');
                });
                
                // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                const targetSection = 'ideaOwner' + section.charAt(0).toUpperCase() + section.slice(1);
                const targetEl = document.getElementById(targetSection);
                if (targetEl) {
                    targetEl.classList.remove('hidden');
                }
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¨Ø®Ø´
                if (section === 'chat') {
                    loadIdeaOwnerChats();
                    hideChatNotification('ideaOwner');
                } else if (section === 'exams') {
                    updateMedalsDisplay();
                    loadExamField();
                } else if (section === 'projects') {
                    loadIdeaOwnerProjects();
                } else if (section === 'ideas') {
                    loadUserIdeas();
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ù†Ùˆ
                updateNavigation('ideaOwnerDashboard', section);
            } catch (error) {
                console.error('Error showing idea owner section:', error);
            }
        }
        
        function showInvestorSection(section) {
            try {
                // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§
                const sections = ['investorProfile', 'investorIdeas', 'investorInvestments', 'investorEscrow', 'investorChat'];
                sections.forEach(s => {
                    const el = document.getElementById(s);
                    if (el) el.classList.add('hidden');
                });
                
                // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
                const targetSection = 'investor' + section.charAt(0).toUpperCase() + section.slice(1);
                const targetEl = document.getElementById(targetSection);
                if (targetEl) {
                    targetEl.classList.remove('hidden');
                }
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¨Ø®Ø´
                if (section === 'ideas') {
                    loadAvailableIdeas();
                } else if (section === 'investments') {
                    loadUserInvestments();
                } else if (section === 'escrow') {
                    loadEscrowTransactions();
                } else if (section === 'chat') {
                    loadInvestorChats();
                    hideChatNotification('investor');
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ù†Ùˆ
                updateNavigation('investorDashboard', section);
            } catch (error) {
                console.error('Error showing investor section:', error);
            }
        }
        
        function updateNavigation(dashboard, activeSection) {
            try {
                const navItems = document.querySelectorAll(`#${dashboard} .nav-item`);
                navItems.forEach(item => {
                    if (item) {
                        item.classList.remove('active');
                        if (item.getAttribute('data-section') === activeSection) {
                            item.classList.add('active');
                        }
                    }
                });
            } catch (error) {
                console.error('Error updating navigation:', error);
            }
        }
        
        function viewIdeaDetails(ideaId) {
            hideAllPages();
            document.getElementById('ideaDetailsPage').classList.remove('hidden');
        }
        
        function sendMessage(chatType = 'ideaOwner') {
            let input, messagesContainer;
            
            if (chatType === 'investor') {
                input = document.getElementById('investorChatInput');
                messagesContainer = document.getElementById('investorChatMessages');
            } else {
                input = document.getElementById('ideaOwnerChatInput');
                messagesContainer = document.getElementById('ideaOwnerChatMessages');
            }
            
            if (input && !input.disabled) {
                const message = input.value.trim();
                if (message) {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'flex justify-end';
                    messageDiv.innerHTML = `
                        <div class="bg-purple-600 rounded-lg p-3 max-w-xs">
                            <p class="text-white">${message}</p>
                        </div>
                    `;
                    messagesContainer.appendChild(messageDiv);
                    input.value = '';
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }
        }
        
        function submitIdea() {
            try {
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ
                if (!currentUser || !currentUser.id) {
                    alert('âŒ Ø®Ø·Ø§: Ú©Ø§Ø±Ø¨Ø± ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.');
                    return;
                }
                
                const titleEl = document.getElementById('ideaTitle');
                const categoryEl = document.getElementById('ideaCategory');
                const descriptionEl = document.getElementById('ideaDescription');
                
                if (!titleEl || !categoryEl || !descriptionEl) {
                    alert('âŒ Ø®Ø·Ø§ Ø¯Ø± ÛŒØ§ÙØªÙ† Ø¹Ù†Ø§ØµØ± ÙØ±Ù…');
                    return;
                }
                
                const title = titleEl.value.trim();
                const category = categoryEl.value;
                const description = descriptionEl.value.trim();
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§
                if (!title) {
                    alert('âŒ Ù„Ø·ÙØ§Ù‹ Ù…ÙˆØ¶ÙˆØ¹ Ø§ÛŒØ¯Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                    titleEl.focus();
                    return;
                }
                
                if (!category) {
                    alert('âŒ Ù„Ø·ÙØ§Ù‹ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                    categoryEl.focus();
                    return;
                }
                
                if (!description) {
                    alert('âŒ Ù„Ø·ÙØ§Ù‹ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§ÛŒØ¯Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                    descriptionEl.focus();
                    return;
                }
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø·ÙˆÙ„ Ù…ÙˆØ¶ÙˆØ¹ (Ø­Ø¯Ø§Ú©Ø«Ø± ÛŒÚ© Ø®Ø·)
                if (title.length > 80) {
                    alert('âŒ Ù…ÙˆØ¶ÙˆØ¹ Ø§ÛŒØ¯Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² 80 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨ÛŒØ´ØªØ± Ø¨Ø§Ø´Ø¯\n\nØ·ÙˆÙ„ ÙØ¹Ù„ÛŒ: ' + title.length + ' Ú©Ø§Ø±Ø§Ú©ØªØ±');
                    titleEl.focus();
                    return;
                }
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø­Ø¯Ø§Ù‚Ù„ Ø·ÙˆÙ„ ØªÙˆØ¶ÛŒØ­Ø§Øª (Ø­Ø¯Ø§Ù‚Ù„ Ø³Ù‡ Ø®Ø·)
                if (description.length < 50) {
                    alert('âŒ ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§ÛŒØ¯Ù‡ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 50 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯\n\nØ·ÙˆÙ„ ÙØ¹Ù„ÛŒ: ' + description.length + ' Ú©Ø§Ø±Ø§Ú©ØªØ±');
                    descriptionEl.focus();
                    return;
                }
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³
                const contactPatterns = [
                    /\b09\d{9}\b/g, // Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
                    /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g, // Ø§ÛŒÙ…ÛŒÙ„
                    /@[a-zA-Z0-9_]+/g // Ø§Ú©Ø§Ù†Øª Ø´Ø¨Ú©Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ
                ];
                
                const fullText = title + ' ' + description;
                let foundContacts = [];
                
                contactPatterns.forEach(pattern => {
                    const matches = fullText.match(pattern);
                    if (matches) {
                        foundContacts = foundContacts.concat(matches);
                    }
                });
                
                if (foundContacts.length > 0) {
                    alert(`âŒ Ø®Ø·Ø§: Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³ Ø¯Ø± Ù…ØªÙ† Ø§ÛŒØ¯Ù‡ Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª!\n\nÙ…ÙˆØ§Ø±Ø¯ ÛŒØ§ÙØª Ø´Ø¯Ù‡: ${foundContacts.join(', ')}\n\nÙ„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³ Ø±Ø§ Ø­Ø°Ù Ú©Ø±Ø¯Ù‡ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.`);
                    return;
                }
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ø§ÛŒØ¯Ù‡ Ø¬Ø¯ÛŒØ¯
                const newIdea = {
                    id: Date.now().toString(),
                    title: title,
                    category: category,
                    description: description,
                    ownerId: currentUser.id,
                    ownerName: currentUser.name,
                    ownerMedals: getUserMedalsForCategory(category),
                    status: 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ',
                    createdAt: new Date().toISOString(),
                    aiScore: null,
                    price: null
                };
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø§ÛŒØ¯Ù‡ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú©
                saveIdeaToCloud(newIdea);
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
                titleEl.value = '';
                categoryEl.value = '';
                descriptionEl.value = '';
                
                alert('âœ… Ø§ÛŒØ¯Ù‡ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯!\n\nğŸ¤– Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆØ³Ø· Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ...\n\nâ±ï¸ Ù„Ø·ÙØ§Ù‹ Ú†Ù†Ø¯ Ø«Ø§Ù†ÛŒÙ‡ ØµØ¨Ø± Ú©Ù†ÛŒØ¯');
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø±Ø³ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                setTimeout(() => {
                    try {
                        processIdeaWithAI(newIdea.id);
                    } catch (error) {
                        console.error('Error in AI processing:', error);
                        alert('âœ… Ø§ÛŒØ¯Ù‡ Ø«Ø¨Øª Ø´Ø¯ Ø§Ù…Ø§ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø±Ø® Ø¯Ø§Ø¯');
                    }
                }, 3000);
                
                // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§
                showIdeaOwnerSection('ideas');
                
            } catch (error) {
                console.error('Error submitting idea:', error);
                alert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø§ÛŒØ¯Ù‡: ' + error.message + '\n\nÙ„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
            }
        }
        
        function getUserMedalsForCategory(category) {
            if (!currentUser.medals || !currentUser.profile || !currentUser.profile.examField) {
                return [];
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ ØªØ·Ø§Ø¨Ù‚ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒØ¯Ù‡ Ø¨Ø§ Ø²Ù…ÛŒÙ†Ù‡ Ø¢Ø²Ù…ÙˆÙ†
            const examField = currentUser.profile.examField;
            const categoryMapping = {
                'ÙÙ†Ø§ÙˆØ±ÛŒ': 'ÙÙ†Ø§ÙˆØ±ÛŒ',
                'Ú©Ø³Ø¨ Ùˆ Ú©Ø§Ø±': 'Ú©Ø³Ø¨ Ùˆ Ú©Ø§Ø±', 
                'Ø³Ù„Ø§Ù…Øª': 'Ø³Ù„Ø§Ù…Øª',
                'Ø¢Ù…ÙˆØ²Ø´': 'Ø¢Ù…ÙˆØ²Ø´',
                'Ø³Ø±Ú¯Ø±Ù…ÛŒ': 'Ø³Ø±Ú¯Ø±Ù…ÛŒ',
                'Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª': 'Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª',
                'Ù…Ø§Ù„ÛŒ': 'Ù…Ø§Ù„ÛŒ'
            };
            
            if (categoryMapping[category] === examField) {
                return currentUser.medals;
            }
            
            return [];
        }
        
        // Ø³ÛŒØ³ØªÙ… Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø´ØªØ±Ú© Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§
        function saveIdeaToCloud(idea) {
            try {
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage Ù…Ø­Ù„ÛŒ
                let ideas = JSON.parse(localStorage.getItem('platformIdeas')) || [];
                ideas.push(idea);
                localStorage.setItem('platformIdeas', JSON.stringify(ideas));
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú© (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ cloud storage)
                const cloudKey = 'globalPlatformIdeas';
                let globalIdeas = [];
                
                try {
                    // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø² Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú©
                    const existingGlobalData = localStorage.getItem(cloudKey);
                    if (existingGlobalData) {
                        globalIdeas = JSON.parse(existingGlobalData);
                    }
                } catch (e) {
                    globalIdeas = [];
                }
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÛŒØ¯Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú©
                globalIdeas.push(idea);
                localStorage.setItem(cloudKey, JSON.stringify(globalIdeas));
                
                console.log('Idea saved to cloud:', idea.title);
            } catch (error) {
                console.error('Error saving idea to cloud:', error);
            }
        }
        
        function loadIdeasFromCloud() {
            try {
                const cloudKey = 'globalPlatformIdeas';
                const globalIdeas = JSON.parse(localStorage.getItem(cloudKey)) || [];
                
                // ØªØ±Ú©ÛŒØ¨ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ù„ÛŒ Ùˆ Ù…Ø´ØªØ±Ú©
                const localIdeas = JSON.parse(localStorage.getItem('platformIdeas')) || [];
                
                // Ø­Ø°Ù ØªÚ©Ø±Ø§Ø±ÛŒâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ID
                const allIdeas = [...localIdeas];
                globalIdeas.forEach(globalIdea => {
                    if (!allIdeas.find(idea => idea.id === globalIdea.id)) {
                        allIdeas.push(globalIdea);
                    }
                });
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ localStorage Ù…Ø­Ù„ÛŒ
                localStorage.setItem('platformIdeas', JSON.stringify(allIdeas));
                
                return allIdeas;
            } catch (error) {
                console.error('Error loading ideas from cloud:', error);
                return JSON.parse(localStorage.getItem('platformIdeas')) || [];
            }
        }
        
        function processIdeaWithAI(ideaId) {
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú©
            const ideas = loadIdeasFromCloud();
            const ideaIndex = ideas.findIndex(idea => idea.id === ideaId);
            
            if (ideaIndex !== -1) {
                const idea = ideas[ideaIndex];
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ÛŒØ¯Ù‡
                const aiAnalysis = analyzeIdeaWithAI(idea);
                
                ideas[ideaIndex].status = aiAnalysis.approved ? 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡' : 'Ø±Ø¯ Ø´Ø¯Ù‡';
                ideas[ideaIndex].aiScore = aiAnalysis.score;
                ideas[ideaIndex].price = aiAnalysis.price;
                ideas[ideaIndex].aiAnalysis = aiAnalysis.analysis;
                ideas[ideaIndex].marketPotential = aiAnalysis.marketPotential;
                ideas[ideaIndex].technicalFeasibility = aiAnalysis.technicalFeasibility;
                ideas[ideaIndex].competitiveAdvantage = aiAnalysis.competitiveAdvantage;
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ù‡Ø± Ø¯Ùˆ Ø³ÛŒØ³ØªÙ…
                localStorage.setItem('platformIdeas', JSON.stringify(ideas));
                localStorage.setItem('globalPlatformIdeas', JSON.stringify(ideas));
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´
                loadUserIdeas();
                loadAvailableIdeas();
                
                if (aiAnalysis.approved) {
                    alert(`ğŸ‰ Ø§ÛŒØ¯Ù‡ Ø´Ù…Ø§ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯!\n\nâ­ Ø§Ù…ØªÛŒØ§Ø²: ${aiAnalysis.score}\nğŸ’° Ù‚ÛŒÙ…Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ: ${aiAnalysis.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†\n\nğŸ¤– ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ:\n${aiAnalysis.analysis}`);
                } else {
                    alert(`âŒ Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø§ÛŒØ¯Ù‡ Ø´Ù…Ø§ ØªØ§ÛŒÛŒØ¯ Ù†Ø´Ø¯.\n\nğŸ¤– Ø¯Ù„ÛŒÙ„:\n${aiAnalysis.analysis}\n\nÙ„Ø·ÙØ§Ù‹ Ø§ÛŒØ¯Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¯Ù‡ÛŒØ¯ Ùˆ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.`);
                }
            }
        }
        
        function analyzeIdeaWithAI(idea) {
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
            const title = idea.title.toLowerCase();
            const description = idea.description.toLowerCase();
            const category = idea.category;
            
            let score = 0;
            let analysis = '';
            let marketPotential = 0;
            let technicalFeasibility = 0;
            let competitiveAdvantage = 0;
            
            // ØªØ­Ù„ÛŒÙ„ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ
            const innovativeKeywords = ['Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡', 'Ø¬Ø¯ÛŒØ¯', 'Ù…Ù†Ø­ØµØ±', 'Ø§Ù†Ù‚Ù„Ø§Ø¨ÛŒ', 'Ù¾ÛŒØ´Ø±ÙØªÙ‡', 'Ù‡ÙˆØ´Ù…Ù†Ø¯', 'Ø®Ù„Ø§Ù‚Ø§Ù†Ù‡'];
            const techKeywords = ['Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ', 'Ø¨Ù„Ø§Ú© Ú†ÛŒÙ†', 'Ø§ÛŒÙ†ØªØ±Ù†Øª Ø§Ø´ÛŒØ§', 'ÙˆØ§Ù‚Ø¹ÛŒØª Ù…Ø¬Ø§Ø²ÛŒ', 'ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ†'];
            const marketKeywords = ['Ø¨Ø§Ø²Ø§Ø±', 'Ù…Ø´ØªØ±ÛŒ', 'ÙØ±ÙˆØ´', 'Ø¯Ø±Ø¢Ù…Ø¯', 'Ø³ÙˆØ¯', 'Ø±Ù‚Ø§Ø¨Øª'];
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¢ÙˆØ±ÛŒ
            const innovationScore = innovativeKeywords.filter(keyword => 
                title.includes(keyword) || description.includes(keyword)
            ).length;
            
            // Ø¨Ø±Ø±Ø³ÛŒ ÙÙ†Ø§ÙˆØ±ÛŒ
            const techScore = techKeywords.filter(keyword => 
                title.includes(keyword) || description.includes(keyword)
            ).length;
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø§Ø²Ø§Ø±
            const marketScore = marketKeywords.filter(keyword => 
                title.includes(keyword) || description.includes(keyword)
            ).length;
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª
            marketPotential = Math.min(100, (marketScore * 20) + (Math.random() * 40) + 30);
            technicalFeasibility = Math.min(100, (techScore * 15) + (Math.random() * 50) + 25);
            competitiveAdvantage = Math.min(100, (innovationScore * 25) + (Math.random() * 40) + 20);
            
            const overallScore = (marketPotential + technicalFeasibility + competitiveAdvantage) / 3;
            
            // ØªØ¹ÛŒÛŒÙ† ÙˆØ¶Ø¹ÛŒØª Ù†Ù‡Ø§ÛŒÛŒ
            let approved = true;
            let finalScore = '';
            let price = 0;
            
            if (overallScore >= 70) {
                finalScore = 'Ø¹Ø§Ù„ÛŒ';
                price = Math.floor(Math.random() * 15000) + 30000; // 30-45 Ù‡Ø²Ø§Ø±
                analysis = `Ø§ÛŒØ¯Ù‡ Ø´Ù…Ø§ Ø¨Ø³ÛŒØ§Ø± Ù‚ÙˆÛŒ Ùˆ Ø¨Ø§ Ù¾ØªØ§Ù†Ø³ÛŒÙ„ Ø¨Ø§Ù„Ø§ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯. Ù†Ù‚Ø§Ø· Ù‚ÙˆØª: Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø¨Ø§Ù„Ø§ØŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø¬Ø±Ø§ Ù…Ù†Ø§Ø³Ø¨ØŒ Ùˆ Ù…Ø²ÛŒØª Ø±Ù‚Ø§Ø¨ØªÛŒ Ø®ÙˆØ¨.`;
            } else if (overallScore >= 50) {
                finalScore = 'Ø®ÙˆØ¨';
                price = Math.floor(Math.random() * 10000) + 20000; // 20-30 Ù‡Ø²Ø§Ø±
                analysis = `Ø§ÛŒØ¯Ù‡ Ø´Ù…Ø§ Ù¾ØªØ§Ù†Ø³ÛŒÙ„ Ø®ÙˆØ¨ÛŒ Ø¯Ø§Ø±Ø¯ Ø§Ù…Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¯Ø± Ø¨Ø±Ø®ÛŒ Ø¬Ù†Ø¨Ù‡â€ŒÙ‡Ø§ Ø¯Ø§Ø±Ø¯. Ø¨Ø§ ØªÙˆØ³Ø¹Ù‡ Ø¨ÛŒØ´ØªØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…ÙˆÙÙ‚ Ø¨Ø§Ø´Ø¯.`;
            } else if (overallScore >= 30) {
                finalScore = 'Ù…ØªÙˆØ³Ø·';
                price = Math.floor(Math.random() * 8000) + 12000; // 12-20 Ù‡Ø²Ø§Ø±
                analysis = `Ø§ÛŒØ¯Ù‡ Ø´Ù…Ø§ Ø¯Ø± Ø³Ø·Ø­ Ù…ØªÙˆØ³Ø· Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯. Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø§Ø²Ù†Ú¯Ø±ÛŒ Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¯Ø± Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¨Ø§Ø²Ø§Ø± Ùˆ Ø§Ø¬Ø±Ø§ Ø¯Ø§Ø±Ø¯.`;
            } else {
                approved = false;
                analysis = `Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø§ÛŒØ¯Ù‡ Ø´Ù…Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¢Ù…Ø§Ø¯Ú¯ÛŒ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¨Ø§Ø²Ø§Ø± Ø±Ø§ Ù†Ø¯Ø§Ø±Ø¯. Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø±ÙˆÛŒ Ù†ÙˆØ¢ÙˆØ±ÛŒØŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø¬Ø±Ø§ Ùˆ ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ø§Ø± Ø¨ÛŒØ´ØªØ± Ú©Ø§Ø± Ú©Ù†ÛŒØ¯.`;
            }
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¬Ø²Ø¦ÛŒØ§Øª ØªØ­Ù„ÛŒÙ„
            if (approved) {
                analysis += `\n\nğŸ“Š Ø¬Ø²Ø¦ÛŒØ§Øª ØªØ­Ù„ÛŒÙ„:\nâ€¢ Ù¾ØªØ§Ù†Ø³ÛŒÙ„ Ø¨Ø§Ø²Ø§Ø±: ${Math.round(marketPotential)}%\nâ€¢ Ù‚Ø§Ø¨Ù„ÛŒØª ÙÙ†ÛŒ: ${Math.round(technicalFeasibility)}%\nâ€¢ Ù…Ø²ÛŒØª Ø±Ù‚Ø§Ø¨ØªÛŒ: ${Math.round(competitiveAdvantage)}%`;
            }
            
            return {
                approved,
                score: finalScore,
                price,
                analysis,
                marketPotential: Math.round(marketPotential),
                technicalFeasibility: Math.round(technicalFeasibility),
                competitiveAdvantage: Math.round(competitiveAdvantage)
            };
        }
        
        function loadUserIdeas() {
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú©
            const ideas = loadIdeasFromCloud();
            const userIdeas = ideas.filter(idea => idea.ownerId === currentUser.id);
            const container = document.getElementById('userIdeasContainer');
            
            if (userIdeas.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ’¡</div>
                        <h4 class="text-xl font-bold text-gray-400 mb-2">Ù‡Ù†ÙˆØ² Ø§ÛŒØ¯Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯</h4>
                        <p class="text-gray-500 mb-6">Ø§ÙˆÙ„ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯ Ùˆ Ø´Ø±ÙˆØ¹ Ø¨Ù‡ Ú©Ø³Ø¨ Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù†ÛŒØ¯</p>
                        <button onclick="showIdeaOwnerSection('submit')" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg transition-colors">
                            Ø«Ø¨Øª Ø§ÙˆÙ„ÛŒÙ† Ø§ÛŒØ¯Ù‡
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = userIdeas.map(idea => {
                const statusColor = idea.status === 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡' ? 'bg-green-600' : 
                                  idea.status === 'Ø±Ø¯ Ø´Ø¯Ù‡' ? 'bg-red-600' : 'bg-yellow-600';
                
                // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø§ÛŒØ¯Ù‡
                const medalIcons = { bronze: 'ğŸ¥‰', silver: 'ğŸ¥ˆ', gold: 'ğŸ¥‡' };
                const medalsHtml = idea.ownerMedals && idea.ownerMedals.length > 0 ? 
                    idea.ownerMedals.map(medal => `<span class="text-lg">${medalIcons[medal]}</span>`).join('') : '';
                
                return `
                    <div class="bg-gray-800/50 backdrop-blur-lg rounded-xl p-6 border border-purple-500/30">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="flex items-center gap-2 mb-2">
                                    <h4 class="text-xl font-bold">${idea.title}</h4>
                                    ${medalsHtml ? `<div class="flex gap-1">${medalsHtml}</div>` : ''}
                                </div>
                                <p class="text-gray-400">Ø¯Ø³ØªÙ‡: ${idea.category}</p>
                                ${idea.price ? `<p class="text-green-400 font-bold">Ù‚ÛŒÙ…Øª: ${idea.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>` : ''}
                            </div>
                            <span class="${statusColor} text-xs px-3 py-1 rounded-full">${idea.status}</span>
                        </div>
                        <p class="text-gray-300 mb-4">${idea.description.substring(0, 100)}...</p>
                        <div class="flex gap-2">
                            <button onclick="viewIdeaDetails('${idea.id}')" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>
                            <button onclick="editIdea('${idea.id}')" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors">ÙˆÛŒØ±Ø§ÛŒØ´</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function loadAvailableIdeas() {
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú©
            const ideas = loadIdeasFromCloud();
            const availableIdeas = ideas.filter(idea => idea.status === 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡' && idea.ownerId !== currentUser.id);
            const container = document.getElementById('availableIdeasContainer');
            
            if (availableIdeas.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ”</div>
                        <h4 class="text-xl font-bold text-gray-400 mb-2">Ù‡Ù†ÙˆØ² Ø§ÛŒØ¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</h4>
                        <p class="text-gray-500">Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = availableIdeas.map(idea => {
                // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±
                const medalIcons = { bronze: 'ğŸ¥‰', silver: 'ğŸ¥ˆ', gold: 'ğŸ¥‡' };
                const medalsHtml = idea.ownerMedals && idea.ownerMedals.length > 0 ? 
                    idea.ownerMedals.map(medal => `<span class="text-lg">${medalIcons[medal]}</span>`).join('') : '';
                
                return `
                    <div class="bg-gray-800/50 backdrop-blur-lg rounded-xl p-6 border border-purple-500/30 card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="flex items-center gap-2 mb-2">
                                    <h4 class="text-xl font-bold text-purple-300">${idea.title}</h4>
                                    ${medalsHtml ? `<div class="flex gap-1">${medalsHtml}</div>` : ''}
                                </div>
                                <p class="text-gray-400">Ø¯Ø³ØªÙ‡: ${idea.category} | Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±: ${idea.ownerName}</p>
                            </div>
                        </div>
                        <p class="text-gray-300 mb-4">${idea.description.substring(0, 150)}...</p>
                        <div class="flex justify-between items-center">
                            <div class="ai-indicator text-xs px-3 py-1 rounded-full text-white">
                                ğŸ¤– ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                            </div>
                            <div class="flex gap-2">
                                <span class="text-green-400 font-bold">${idea.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                                <button onclick="viewOwnerProfile('${idea.ownerId}')" class="bg-purple-600 hover:bg-purple-700 px-3 py-2 rounded-lg transition-colors text-sm">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
                                <button onclick="viewIdeaDetailsForPurchase('${idea.id}')" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function loadUserInvestments() {
            const investments = JSON.parse(localStorage.getItem('userInvestments_' + currentUser.id)) || [];
            const container = document.getElementById('userInvestmentsContainer');
            
            if (investments.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ“Š</div>
                        <h4 class="text-xl font-bold text-gray-400 mb-2">Ù‡Ù†ÙˆØ² Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯</h4>
                        <p class="text-gray-500 mb-6">Ø¯Ø± Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±ØªØ± Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ø³Ø¨ Ú©Ù†ÛŒØ¯</p>
                        <button onclick="showInvestorSection('ideas')" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg transition-colors">
                            Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = investments.map(investment => `
                <div class="bg-gray-800/50 backdrop-blur-lg rounded-xl p-6 border border-green-500/30">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="text-xl font-bold">${investment.ideaTitle}</h4>
                            <p class="text-gray-400">Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ø¯Ø±: ${new Date(investment.purchaseDate).toLocaleDateString('fa-IR')}</p>
                        </div>
                        <span class="bg-green-600 text-xs px-3 py-1 rounded-full">ÙØ¹Ø§Ù„</span>
                    </div>
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <p class="text-gray-400">Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</p>
                            <p class="text-white font-bold">${investment.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
                        </div>
                        <div>
                            <p class="text-gray-400">ÙˆØ¶Ø¹ÛŒØª Ù‡Ù…Ú©Ø§Ø±ÛŒ</p>
                            <p class="text-green-400 font-bold">Ø¯Ø± Ø­Ø§Ù„ Ù‡Ù…Ú©Ø§Ø±ÛŒ</p>
                        </div>
                        <div>
                            <p class="text-gray-400">Ù¾ÛŒØ´Ø±ÙØª</p>
                            <p class="text-blue-400 font-bold">${Math.floor(Math.random() * 40) + 30}%</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¢Ø²Ù…ÙˆÙ†
        let currentExam = null;
        let currentQuestionIndex = 0;
        let examTimer = null;
        let examTimeLeft = 0;
        let userAnswers = [];
        
        function updateExamField() {
            try {
                const examFieldEl = document.getElementById('examField');
                if (!examFieldEl) return;
                
                const field = examFieldEl.value;
                if (currentUser) {
                    if (!currentUser.profile) {
                        currentUser.profile = {};
                    }
                    currentUser.profile.examField = field;
                    saveUserData();
                }
            } catch (error) {
                console.error('Error updating exam field:', error);
            }
        }
        
        function startExam(level) {
            const field = document.getElementById('examField').value;
            if (!field) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø²Ù…ÛŒÙ†Ù‡ ØªØ®ØµØµÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            // Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª
            showExamPaymentModal(level, field);
        }
        
        function showExamPaymentModal(level, field) {
            const modal = document.getElementById('examPaymentModal');
            const examCosts = { bronze: 50000, silver: 80000, gold: 120000 };
            const levelNames = { bronze: 'Ø¨Ø±Ù†Ø²', silver: 'Ù†Ù‚Ø±Ù‡', gold: 'Ø·Ù„Ø§' };
            
            // ØªÙ†Ø¸ÛŒÙ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±Ø¯Ø§Ø®Øª
            document.getElementById('examPaymentTitle').textContent = `Ø¢Ø²Ù…ÙˆÙ† Ù…Ø¯Ø§Ù„ ${levelNames[level]}`;
            document.getElementById('examPaymentField').textContent = `Ø²Ù…ÛŒÙ†Ù‡: ${field}`;
            document.getElementById('examPaymentPrice').textContent = `${examCosts[level].toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¨Ù„Øº Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)
            const btcAmount = (examCosts[level] / 2500000000).toFixed(8); // ÙØ±Ø¶: 1 BTC = 2.5 Ù…ÛŒÙ„ÛŒØ§Ø±Ø¯ ØªÙˆÙ…Ø§Ù†
            document.getElementById('examBtcAmount').textContent = `${btcAmount} BTC`;
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø±Ø§ÛŒ Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª
            modal.dataset.examLevel = level;
            modal.dataset.examField = field;
            
            modal.classList.remove('hidden');
        }
        
        function closeExamPaymentModal() {
            const modal = document.getElementById('examPaymentModal');
            modal.classList.add('hidden');
            
            // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ±Ù… Ù¾Ø±Ø¯Ø§Ø®Øª
            const paymentDetails = document.getElementById('examPaymentDetails');
            const fiatPayment = document.getElementById('examFiatPayment');
            const cryptoPayment = document.getElementById('examCryptoPayment');
            
            paymentDetails.classList.add('hidden');
            fiatPayment.classList.add('hidden');
            cryptoPayment.classList.add('hidden');
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª
            const paymentRadios = document.querySelectorAll('input[name="examPayment"]');
            paymentRadios.forEach(radio => radio.checked = false);
        }
        
        function showExamPaymentDetails(method) {
            const paymentDetails = document.getElementById('examPaymentDetails');
            const fiatPayment = document.getElementById('examFiatPayment');
            const cryptoPayment = document.getElementById('examCryptoPayment');
            
            paymentDetails.classList.remove('hidden');
            
            if (method === 'fiat') {
                fiatPayment.classList.remove('hidden');
                cryptoPayment.classList.add('hidden');
            } else {
                fiatPayment.classList.add('hidden');
                cryptoPayment.classList.remove('hidden');
            }
        }
        
        function processExamPayment() {
            const paymentMethod = document.querySelector('input[name="examPayment"]:checked');
            if (!paymentMethod) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const modal = document.getElementById('examPaymentModal');
            const level = modal.dataset.examLevel;
            const field = modal.dataset.examField;
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾Ø±Ø¯Ø§Ø®Øª
            alert('âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!\n\nØ¢Ø²Ù…ÙˆÙ† Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯...');
            
            closeExamPaymentModal();
            
            // Ø´Ø±ÙˆØ¹ Ø¢Ø²Ù…ÙˆÙ† Ù¾Ø³ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚
            startExamAfterPayment(level, field);
        }
        
        function startExamAfterPayment(level, field) {
            // ØªÙˆÙ„ÛŒØ¯ Ø³ÙˆØ§Ù„Ø§Øª Ø¢Ø²Ù…ÙˆÙ†
            currentExam = generateExam(level, field);
            currentQuestionIndex = 0;
            userAnswers = new Array(currentExam.questions.length).fill(null);
            
            // ØªÙ†Ø¸ÛŒÙ… ØªØ§ÛŒÙ…Ø± - 5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø³ÙˆØ§Ù„
            examTimeLeft = currentExam.questions.length * 5 * 60; // 5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ã— ØªØ¹Ø¯Ø§Ø¯ Ø³ÙˆØ§Ù„Ø§Øª
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø¢Ø²Ù…ÙˆÙ†
            showExamModal();
            startExamTimer();
            displayCurrentQuestion();
        }
        
        function generateExam(level, field) {
            const questionCounts = { bronze: 10, silver: 15, gold: 20 };
            const questionCount = questionCounts[level];
            
            const examData = {
                level: level,
                field: field,
                questions: []
            };
            
            // Ø¨Ø§Ù†Ú© Ø³ÙˆØ§Ù„Ø§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ Ø²Ù…ÛŒÙ†Ù‡
            const questionBanks = {
                'ÙÙ†Ø§ÙˆØ±ÛŒ': [
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ ÙˆØ¨ ÙØ±Ø§Ù†Øªâ€ŒØ§Ù†Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['Python', 'JavaScript', 'C++', 'Java'],
                        correct: 1
                    },
                    {
                        question: 'Ù…ÙÙ‡ÙˆÙ… API Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Application Programming Interface', 'Automated Program Integration', 'Advanced Programming Instructions', 'Application Process Interface'],
                        correct: 0
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… Ù¾Ø±ÙˆØªÚ©Ù„ Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù…Ù† Ø¯Ø§Ø¯Ù‡ Ø¯Ø± ÙˆØ¨ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['HTTP', 'FTP', 'HTTPS', 'SMTP'],
                        correct: 2
                    },
                    {
                        question: 'Ø¯Ø± Ø·Ø±Ø§Ø­ÛŒ UX/UIØŒ Ø§ØµÙ„ "Don\'t Make Me Think" Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø¨Ø§Ø´Ø¯', 'Ú©Ø§Ø±Ø¨Ø± Ù†Ø¨Ø§ÛŒØ¯ ÙÚ©Ø± Ú©Ù†Ø¯', 'Ø±Ø§Ø¨Ø· Ø¨Ø§ÛŒØ¯ Ø³Ø§Ø¯Ù‡ Ùˆ Ù‚Ø§Ø¨Ù„ ÙÙ‡Ù… Ø¨Ø§Ø´Ø¯', 'Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ Ø¨Ø®ÙˆØ§Ù†Ø¯'],
                        correct: 2
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø¦Ùˆ ÙˆØ¨â€ŒØ³Ø§ÛŒØª Ù…Ù‡Ù… Ø§Ø³ØªØŸ',
                        options: ['Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØµØ§ÙˆÛŒØ± Ø²ÛŒØ§Ø¯', 'Ø³Ø±Ø¹Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡', 'Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ§Ø¯', 'ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ù¾Ø§ÛŒÚ¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡ Ø²ÛŒØ± NoSQL Ù…Ø­Ø³ÙˆØ¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['MySQL', 'PostgreSQL', 'MongoDB', 'Oracle'],
                        correct: 2
                    },
                    {
                        question: 'Ø¯Ø± Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±ØŒ MVC Ù…Ø®ÙÙ Ú†ÛŒØ³ØªØŸ',
                        options: ['Model View Controller', 'Multiple View Control', 'Main Visual Component', 'Modern Version Control'],
                        correct: 0
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² ÙØ±ÛŒÙ…ÙˆØ±Ú©â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ React Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['Laravel', 'Django', 'Next.js', 'Spring'],
                        correct: 2
                    },
                    {
                        question: 'Ø¯Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒØŒ Ù…ÙÙ‡ÙˆÙ… Machine Learning Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ø³Ø§Ø®Øª Ù…Ø§Ø´ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯', 'ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§', 'Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ù…Ø§Ø´ÛŒÙ†', 'Ú©Ù†ØªØ±Ù„ Ù…Ø§Ø´ÛŒÙ†â€ŒÙ‡Ø§'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Data Science Ù…Ø­Ø¨ÙˆØ¨ Ø§Ø³ØªØŸ',
                        options: ['HTML', 'CSS', 'Python', 'XML'],
                        correct: 2
                    },
                    {
                        question: 'Ø¯Ø± Ø§Ù…Ù†ÛŒØª Ø³Ø§ÛŒØ¨Ø±ÛŒØŒ Ù…ÙÙ‡ÙˆÙ… Encryption Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§', 'Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª', 'ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§', 'Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø³ÛŒØ³ØªÙ…â€ŒØ¹Ø§Ù…Ù„â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ù…ØªÙ†â€ŒØ¨Ø§Ø² Ø§Ø³ØªØŸ',
                        options: ['Windows', 'macOS', 'Linux', 'iOS'],
                        correct: 2
                    },
                    {
                        question: 'Ø¯Ø± Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±ÛŒØŒ IP Ù…Ø®ÙÙ Ú†ÛŒØ³ØªØŸ',
                        options: ['Internet Protocol', 'Internal Process', 'Information Package', 'Input Program'],
                        correct: 0
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Version Control Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['Photoshop', 'Git', 'Excel', 'PowerPoint'],
                        correct: 1
                    },
                    {
                        question: 'Ø¯Ø± Cloud ComputingØŒ SaaS Ù…Ø®ÙÙ Ú†ÛŒØ³ØªØŸ',
                        options: ['Software as a Service', 'System as a Solution', 'Security as a Standard', 'Storage as a Service'],
                        correct: 0
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Agile Development Ù…Ø­Ø¨ÙˆØ¨ Ø§Ø³ØªØŸ',
                        options: ['Waterfall', 'Scrum', 'V-Model', 'Spiral'],
                        correct: 1
                    },
                    {
                        question: 'Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ†ÙˆÛŒØ³ÛŒØŒ Ù…ÙÙ‡ÙˆÙ… OOP Ù…Ø®ÙÙ Ú†ÛŒØ³ØªØŸ',
                        options: ['Object Oriented Programming', 'Online Operating Platform', 'Optimized Output Process', 'Open Office Protocol'],
                        correct: 0
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§Ù†ÙˆØ§Ø¹ ØªØ³Øª Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø± Ø§Ø³ØªØŸ',
                        options: ['Unit Test', 'Integration Test', 'System Test', 'Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯'],
                        correct: 3
                    },
                    {
                        question: 'Ø¯Ø± DevOpsØŒ Ù…ÙÙ‡ÙˆÙ… CI/CD Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Continuous Integration/Continuous Deployment', 'Computer Interface/Code Development', 'Central Intelligence/Code Distribution', 'Custom Installation/Complete Design'],
                        correct: 0
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ù¾Ø±ÙˆØªÚ©Ù„â€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['HTTP', 'FTP', 'SMTP', 'SSH'],
                        correct: 2
                    }
                ],
                'Ú©Ø³Ø¨ Ùˆ Ú©Ø§Ø±': [
                    {
                        question: 'Ù…Ø¯Ù„ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± B2B Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Business to Business', 'Business to Buyer', 'Brand to Business', 'Business to Bank'],
                        correct: 0
                    },
                    {
                        question: 'Ø¯Ø± Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ØŒ ROI Ù…Ø®ÙÙ Ú†ÛŒØ³ØªØŸ',
                        options: ['Return on Investment', 'Rate of Interest', 'Revenue of Income', 'Return of Income'],
                        correct: 0
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø¹ÙˆØ§Ù…Ù„ Ø²ÛŒØ± Ø¯Ø± ØªØ­Ù„ÛŒÙ„ SWOT Ù‚Ø±Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ØŸ',
                        options: ['Ù†Ù‚Ø§Ø· Ù‚ÙˆØª', 'Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù', 'ÙØ±ØµØªâ€ŒÙ‡Ø§', 'Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ'],
                        correct: 3
                    },
                    {
                        question: 'Ù…ÙÙ‡ÙˆÙ… MVP Ø¯Ø± Ø§Ø³ØªØ§Ø±ØªØ§Ù¾â€ŒÙ‡Ø§ Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Most Valuable Player', 'Minimum Viable Product', 'Maximum Value Proposition', 'Market Value Product'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¬Ø¯ÛŒØ¯ Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³ØªØŸ',
                        options: ['Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‡Ø²ÛŒÙ†Ù‡', 'Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø±Ù‚Ø§Ø¨ØªÛŒ', 'Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù†ÙÙˆØ°ÛŒ', 'Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯'],
                        correct: 3
                    },
                    {
                        question: 'Ø¯Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡ØŒ Ù…ÙÙ‡ÙˆÙ… Agile Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ù†ØªÛŒ', 'Ù…Ø¯ÛŒØ±ÛŒØª Ú†Ø§Ø¨Ú© Ùˆ Ø§Ù†Ø¹Ø·Ø§Ùâ€ŒÙ¾Ø°ÛŒØ±', 'Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø®Øªâ€ŒÚ¯ÛŒØ±Ø§Ù†Ù‡', 'Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·ÛŒ'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ù…Ø±Ø§Ø­Ù„ ÙØ±ÙˆØ´ Ø¯Ø± Ù‚ÛŒÙ ÙØ±ÙˆØ´ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯ØŸ',
                        options: ['ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØµÙˆÙ„', 'Ø¬Ø°Ø¨ Ù…Ø´ØªØ±ÛŒ', 'Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ', 'Ù…Ù†Ø§Ø¨Ø¹ Ø§Ù†Ø³Ø§Ù†ÛŒ'],
                        correct: 1
                    },
                    {
                        question: 'Ø¯Ø± Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒØŒ Ù…ÙÙ‡ÙˆÙ… Target Audience Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ú©Ù„ Ø¨Ø§Ø²Ø§Ø±', 'Ù…Ø®Ø§Ø·Ø¨ Ù‡Ø¯Ù', 'Ø±Ù‚Ø¨Ø§', 'ØªÙˆÙ„ÛŒØ¯Ú©Ù†Ù†Ø¯Ú¯Ø§Ù†'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ KPI Ù…Ø­Ø³ÙˆØ¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['Ø±Ù†Ú¯ Ù„ÙˆÚ¯Ùˆ', 'Ù†Ø±Ø® ØªØ¨Ø¯ÛŒÙ„', 'Ù†ÙˆØ¹ ÙÙˆÙ†Øª', 'Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¯ÙØªØ±'],
                        correct: 1
                    },
                    {
                        question: 'Ø¯Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒØŒ Cash Flow Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ø¬Ø±ÛŒØ§Ù† Ù†Ù‚Ø¯ÛŒ', 'Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ', 'Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ù„', 'Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø«Ø§Ø¨Øª'],
                        correct: 0
                    },
                    {
                        question: 'Ù…ÙÙ‡ÙˆÙ… Brand Identity Ø¯Ø± Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ Ú†ÛŒØ³ØªØŸ',
                        options: ['Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„', 'Ù‡ÙˆÛŒØª Ø¨Ø±Ù†Ø¯', 'Ú©ÛŒÙÛŒØª Ù…Ø­ØµÙˆÙ„', 'Ù…Ú©Ø§Ù† ÙØ±ÙˆØ´'],
                        correct: 1
                    },
                    {
                        question: 'Ø¯Ø± ØªØ­Ù„ÛŒÙ„ Ø¨Ø§Ø²Ø§Ø±ØŒ Ù…ÙÙ‡ÙˆÙ… Market Share Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ø³Ù‡Ù… Ø¨Ø§Ø²Ø§Ø±', 'Ø§Ù†Ø¯Ø§Ø²Ù‡ Ø¨Ø§Ø²Ø§Ø±', 'Ø±Ø´Ø¯ Ø¨Ø§Ø²Ø§Ø±', 'Ù†ÙˆØ¹ Ø¨Ø§Ø²Ø§Ø±'],
                        correct: 0
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ù‚Ø§Ø¨ØªÛŒ Ù¾ÙˆØ±ØªØ± Ø§Ø³ØªØŸ',
                        options: ['ØªÙ…Ø±Ú©Ø² Ø¨Ø± Ù‡Ø²ÛŒÙ†Ù‡', 'ØªÙ…Ø§ÛŒØ²', 'ØªÙ…Ø±Ú©Ø²', 'Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯'],
                        correct: 3
                    },
                    {
                        question: 'Ø¯Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†Ø§Ø¨Ø¹ Ø§Ù†Ø³Ø§Ù†ÛŒØŒ HR Ù…Ø®ÙÙ Ú†ÛŒØ³ØªØŸ',
                        options: ['High Revenue', 'Human Resources', 'Hard Requirements', 'Health Records'],
                        correct: 1
                    },
                    {
                        question: 'Ù…ÙÙ‡ÙˆÙ… Customer Lifetime Value Ú†ÛŒØ³ØªØŸ',
                        options: ['Ø³Ù† Ù…Ø´ØªØ±ÛŒ', 'Ø§Ø±Ø²Ø´ Ù…Ø§Ø¯Ø§Ù…â€ŒØ§Ù„Ø¹Ù…Ø± Ù…Ø´ØªØ±ÛŒ', 'ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´ØªØ±ÛŒØ§Ù†', 'Ø±Ø¶Ø§ÛŒØª Ù…Ø´ØªØ±ÛŒ'],
                        correct: 1
                    }
                ],
                'Ø³Ù„Ø§Ù…Øª': [
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÙˆÛŒØªØ§Ù…ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø¬Ø°Ø¨ Ú©Ù„Ø³ÛŒÙ… Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³ØªØŸ',
                        options: ['ÙˆÛŒØªØ§Ù…ÛŒÙ† A', 'ÙˆÛŒØªØ§Ù…ÛŒÙ† B', 'ÙˆÛŒØªØ§Ù…ÛŒÙ† C', 'ÙˆÛŒØªØ§Ù…ÛŒÙ† D'],
                        correct: 3
                    },
                    {
                        question: 'Ù†Ø±Ù…Ø§Ù„ ØªØ±ÛŒÙ† Ø¶Ø±Ø¨Ø§Ù† Ù‚Ù„Ø¨ Ø¯Ø± Ø¯Ù‚ÛŒÙ‚Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø²Ø±Ú¯Ø³Ø§Ù„Ø§Ù† Ú†Ù‚Ø¯Ø± Ø§Ø³ØªØŸ',
                        options: ['50-70', '60-100', '80-120', '100-140'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø¹ÙˆØ§Ù…Ù„ Ø²ÛŒØ± Ø®Ø·Ø± Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ù‚Ù„Ø¨ÛŒ Ø±Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ØŸ',
                        options: ['ÙˆØ±Ø²Ø´ Ù…Ù†Ø¸Ù…', 'ØªØºØ°ÛŒÙ‡ Ø³Ø§Ù„Ù…', 'Ø³ÛŒÚ¯Ø§Ø± Ú©Ø´ÛŒØ¯Ù†', 'Ø®ÙˆØ§Ø¨ Ú©Ø§ÙÛŒ'],
                        correct: 2
                    },
                    {
                        question: 'BMI Ù…Ø®ÙÙ Ú†ÛŒØ³ØªØŸ',
                        options: ['Body Mass Index', 'Basic Medical Information', 'Blood Measurement Index', 'Body Muscle Index'],
                        correct: 0
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… Ù…Ø§Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ Ù…Ù†Ø¨Ø¹ Ø®ÙˆØ¨ÛŒ Ø§Ø² Ù¾Ø±ÙˆØªØ¦ÛŒÙ† Ø§Ø³ØªØŸ',
                        options: ['Ø¨Ø±Ù†Ø¬', 'Ù†Ø§Ù†', 'Ú¯ÙˆØ´Øª', 'Ù‚Ù†Ø¯'],
                        correct: 2
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§ÛŒÙ† ÙˆÛŒØªØ§Ù…ÛŒÙ†â€ŒÙ‡Ø§ Ù…Ø­Ù„ÙˆÙ„ Ø¯Ø± Ø¢Ø¨ Ø§Ø³ØªØŸ',
                        options: ['ÙˆÛŒØªØ§Ù…ÛŒÙ† A', 'ÙˆÛŒØªØ§Ù…ÛŒÙ† D', 'ÙˆÛŒØªØ§Ù…ÛŒÙ† C', 'ÙˆÛŒØªØ§Ù…ÛŒÙ† K'],
                        correct: 2
                    },
                    {
                        question: 'ÙØ´Ø§Ø± Ø®ÙˆÙ† Ø·Ø¨ÛŒØ¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø²Ø±Ú¯Ø³Ø§Ù„Ø§Ù† Ú†Ù‚Ø¯Ø± Ø§Ø³ØªØŸ',
                        options: ['140/90', '120/80', '100/60', '160/100'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§ÛŒÙ† Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ Ù…Ù†Ø¨Ø¹ Ø®ÙˆØ¨ÛŒ Ø§Ø² ÙÛŒØ¨Ø± Ø§Ø³ØªØŸ',
                        options: ['Ú¯ÙˆØ´Øª', 'Ø´ÛŒØ±', 'Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ø¨Ø±Ú¯ Ø³Ø¨Ø²', 'Ø±ÙˆØºÙ†'],
                        correct: 2
                    },
                    {
                        question: 'Ú†Ù†Ø¯ Ø³Ø§Ø¹Øª Ø®ÙˆØ§Ø¨ Ø¨Ø±Ø§ÛŒ Ø¨Ø²Ø±Ú¯Ø³Ø§Ù„Ø§Ù† ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['4-5 Ø³Ø§Ø¹Øª', '6-7 Ø³Ø§Ø¹Øª', '7-9 Ø³Ø§Ø¹Øª', '10-12 Ø³Ø§Ø¹Øª'],
                        correct: 2
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§ÛŒÙ† Ø¹ÙˆØ§Ù…Ù„ Ø¨Ø§Ø¹Ø« Ø§ÙØ²Ø§ÛŒØ´ Ú©Ù„Ø³ØªØ±ÙˆÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['ÙˆØ±Ø²Ø´', 'ØºØ°Ø§Ù‡Ø§ÛŒ Ú†Ø±Ø¨', 'Ø¢Ø¨ Ù†ÙˆØ´ÛŒØ¯Ù†', 'Ø®ÙˆØ§Ø¨ Ú©Ø§ÙÛŒ'],
                        correct: 1
                    },
                    {
                        question: 'Ø¯Ø± ØªØºØ°ÛŒÙ‡ Ø³Ø§Ù„Ù…ØŒ Ú†Ù†Ø¯ ÙˆØ¹Ø¯Ù‡ ØºØ°Ø§ Ø¯Ø± Ø±ÙˆØ² ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['2 ÙˆØ¹Ø¯Ù‡', '3 ÙˆØ¹Ø¯Ù‡', '5-6 ÙˆØ¹Ø¯Ù‡ Ú©ÙˆÚ†Ú©', 'Ù‡Ø± Ø²Ù…Ø§Ù† Ú©Ù‡ Ú¯Ø±Ø³Ù†Ù‡ Ø´Ø¯ÛŒØ¯'],
                        correct: 2
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§ÛŒÙ† Ù…ÙˆØ§Ø¯ Ù…ØºØ°ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…Øª Ø§Ø³ØªØ®ÙˆØ§Ù† Ù…Ù‡Ù… Ø§Ø³ØªØŸ',
                        options: ['Ú©Ù„Ø³ÛŒÙ…', 'Ù‚Ù†Ø¯', 'Ú†Ø±Ø¨ÛŒ Ø§Ø´Ø¨Ø§Ø¹', 'Ù†Ù…Ú©'],
                        correct: 0
                    },
                    {
                        question: 'Ú†Ù†Ø¯ Ù„ÛŒØªØ± Ø¢Ø¨ Ø¯Ø± Ø±ÙˆØ² Ø¨Ø±Ø§ÛŒ Ø¨Ø²Ø±Ú¯Ø³Ø§Ù„Ø§Ù† ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['1 Ù„ÛŒØªØ±', '2-3 Ù„ÛŒØªØ±', '5 Ù„ÛŒØªØ±', '0.5 Ù„ÛŒØªØ±'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§ÛŒÙ† ÙˆØ±Ø²Ø´â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…Øª Ù‚Ù„Ø¨ Ù…ÙÛŒØ¯ Ø§Ø³ØªØŸ',
                        options: ['Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ', 'Ù†Ø´Ø³ØªÙ†', 'Ø®ÙˆØ§Ø¨ÛŒØ¯Ù†', 'ØªÙ…Ø§Ø´Ø§ÛŒ ØªÙ„ÙˆÛŒØ²ÛŒÙˆÙ†'],
                        correct: 0
                    },
                    {
                        question: 'Ø§Ø³ØªØ±Ø³ Ù…Ø²Ù…Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø§Ø¹Ø« Ú©Ø¯Ø§Ù… Ù…Ø´Ú©Ù„ Ø´ÙˆØ¯ØŸ',
                        options: ['Ø¨Ù‡Ø¨ÙˆØ¯ Ø­Ø§ÙØ¸Ù‡', 'Ú©Ø§Ù‡Ø´ ÙØ´Ø§Ø± Ø®ÙˆÙ†', 'Ø¶Ø¹Ù Ø³ÛŒØ³ØªÙ… Ø§ÛŒÙ…Ù†ÛŒ', 'Ø§ÙØ²Ø§ÛŒØ´ Ø§Ù†Ø±Ú˜ÛŒ'],
                        correct: 2
                    }
                ],
                'Ø¢Ù…ÙˆØ²Ø´': [
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ ÙØ¹Ø§Ù„ Ù…Ø­Ø³ÙˆØ¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['Ú¯ÙˆØ´ Ø¯Ø§Ø¯Ù† Ø¨Ù‡ Ø³Ø®Ù†Ø±Ø§Ù†ÛŒ', 'Ø¨Ø­Ø« Ú¯Ø±ÙˆÙ‡ÛŒ', 'Ø®ÙˆØ§Ù†Ø¯Ù† Ú©ØªØ§Ø¨', 'ØªÙ…Ø§Ø´Ø§ÛŒ ÙÛŒÙ„Ù…'],
                        correct: 1
                    },
                    {
                        question: 'Ø¯Ø± Ø¢Ù…ÙˆØ²Ø´ØŒ Ù…ÙÙ‡ÙˆÙ… Blended Learning Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ø¢Ù…ÙˆØ²Ø´ Ø­Ø¶ÙˆØ±ÛŒ', 'Ø¢Ù…ÙˆØ²Ø´ Ø¢Ù†Ù„Ø§ÛŒÙ†', 'ØªØ±Ú©ÛŒØ¨ Ø¢Ù…ÙˆØ²Ø´ Ø­Ø¶ÙˆØ±ÛŒ Ùˆ Ø¢Ù†Ù„Ø§ÛŒÙ†', 'Ø¢Ù…ÙˆØ²Ø´ Ø®ÙˆØ¯Ø¢Ù…ÙˆØ²'],
                        correct: 2
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§Ù†ÙˆØ§Ø¹ Ù‡ÙˆØ´ Ú†Ù†Ø¯Ú¯Ø§Ù†Ù‡ Ú¯Ø§Ø±Ø¯Ù†Ø± Ø§Ø³ØªØŸ',
                        options: ['Ù‡ÙˆØ´ Ø±ÛŒØ§Ø¶ÛŒ', 'Ù‡ÙˆØ´ Ù…ÙˆØ³ÛŒÙ‚ÛŒ', 'Ù‡ÙˆØ´ ÙØ¶Ø§ÛŒÛŒ', 'Ù‡Ù…Ù‡ Ù…ÙˆØ§Ø±Ø¯'],
                        correct: 3
                    }
                ],
                'Ø³Ø±Ú¯Ø±Ù…ÛŒ': [
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ù¾Ù„ØªÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù¾Ø®Ø´ ÙˆÛŒØ¯Ø¦Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['Instagram', 'YouTube', 'Twitter', 'LinkedIn'],
                        correct: 1
                    },
                    {
                        question: 'Ø¯Ø± ØµÙ†Ø¹Øª Ø¨Ø§Ø²ÛŒØŒ Ù…ÙÙ‡ÙˆÙ… Indie Game Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ø¨Ø§Ø²ÛŒ Ø¨Ø²Ø±Ú¯', 'Ø¨Ø§Ø²ÛŒ Ù…Ø³ØªÙ‚Ù„', 'Ø¨Ø§Ø²ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†', 'Ø¨Ø§Ø²ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„'],
                        correct: 1
                    }
                ],
                'Ù…Ø­ÛŒØ· Ø²ÛŒØ³Øª': [
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§Ù†Ø±Ú˜ÛŒâ€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± ØªØ¬Ø¯ÛŒØ¯Ù¾Ø°ÛŒØ± Ø§Ø³ØªØŸ',
                        options: ['Ù†ÙØª', 'Ú¯Ø§Ø² Ø·Ø¨ÛŒØ¹ÛŒ', 'Ø§Ù†Ø±Ú˜ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ', 'Ø²ØºØ§Ù„ Ø³Ù†Ú¯'],
                        correct: 2
                    },
                    {
                        question: 'Ù…ÙÙ‡ÙˆÙ… Carbon Footprint Ø¨Ù‡ Ú†Ù‡ Ù…Ø¹Ù†Ø§Ø³ØªØŸ',
                        options: ['Ø±Ø¯Ù¾Ø§ÛŒ Ú©Ø±Ø¨Ù†', 'Ù…ØµØ±Ù Ø¢Ø¨', 'Ø¢Ù„ÙˆØ¯Ú¯ÛŒ ØµÙˆØªÛŒ', 'Ø²Ø¨Ø§Ù„Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø§Ù…Ø¯'],
                        correct: 0
                    }
                ],
                'Ù…Ø§Ù„ÛŒ': [
                    {
                        question: 'Ø¯Ø± Ø¨Ø§Ù†Ú©Ø¯Ø§Ø±ÛŒØŒ Ù…ÙÙ‡ÙˆÙ… Ø³ÙˆØ¯ Ù…Ø±Ú©Ø¨ Ú†ÛŒØ³ØªØŸ',
                        options: ['Ø³ÙˆØ¯ Ø³Ø§Ø¯Ù‡', 'Ø³ÙˆØ¯ Ø±ÙˆÛŒ Ø³ÙˆØ¯', 'Ø³ÙˆØ¯ Ø«Ø§Ø¨Øª', 'Ø³ÙˆØ¯ Ù…ØªØºÛŒØ±'],
                        correct: 1
                    },
                    {
                        question: 'Ú©Ø¯Ø§Ù… ÛŒÚ© Ø§Ø² Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù…â€ŒØ±ÛŒØ³Ú© Ù…Ø­Ø³ÙˆØ¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ',
                        options: ['Ø³Ù‡Ø§Ù…', 'Ø§Ø±Ø² Ø¯ÛŒØ¬ÛŒØªØ§Ù„', 'Ø³Ù¾Ø±Ø¯Ù‡ Ø¨Ø§Ù†Ú©ÛŒ', 'Ú©Ø§Ù„Ø§'],
                        correct: 2
                    }
                ]
            };
            
            // Ø§Ù†ØªØ®Ø§Ø¨ Ø³ÙˆØ§Ù„Ø§Øª ØªØµØ§Ø¯ÙÛŒ
            const availableQuestions = questionBanks[field] || questionBanks['ÙÙ†Ø§ÙˆØ±ÛŒ'];
            const selectedQuestions = [];
            
            for (let i = 0; i < questionCount && i < availableQuestions.length; i++) {
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                if (!selectedQuestions.find(q => q.question === availableQuestions[randomIndex].question)) {
                    selectedQuestions.push({...availableQuestions[randomIndex]});
                }
            }
            
            // Ø§Ú¯Ø± Ø³ÙˆØ§Ù„Ø§Øª Ú©Ø§ÙÛŒ Ù†Ø¨ÙˆØ¯ØŒ ØªÚ©Ø±Ø§Ø± Ú©Ù†
            while (selectedQuestions.length < questionCount) {
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                selectedQuestions.push({...availableQuestions[randomIndex]});
            }
            
            examData.questions = selectedQuestions.slice(0, questionCount);
            return examData;
        }
        
        function showExamModal() {
            const modal = document.getElementById('examModal');
            const title = document.getElementById('examModalTitle');
            
            const levelNames = { bronze: 'Ø¨Ø±Ù†Ø²', silver: 'Ù†Ù‚Ø±Ù‡', gold: 'Ø·Ù„Ø§' };
            title.textContent = `Ø¢Ø²Ù…ÙˆÙ† Ù…Ø¯Ø§Ù„ ${levelNames[currentExam.level]} - ${currentExam.field}`;
            
            document.getElementById('totalQuestions').textContent = currentExam.questions.length;
            
            modal.classList.remove('hidden');
        }
        
        function closeExamModal() {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¢Ø²Ù…ÙˆÙ† Ø±Ø§ ØªØ±Ú© Ú©Ù†ÛŒØ¯ØŸ Ù¾ÛŒØ´Ø±ÙØª Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.')) {
                clearInterval(examTimer);
                document.getElementById('examModal').classList.add('hidden');
                currentExam = null;
            }
        }
        
        function startExamTimer() {
            examTimer = setInterval(() => {
                examTimeLeft--;
                
                const minutes = Math.floor(examTimeLeft / 60);
                const seconds = examTimeLeft % 60;
                
                document.getElementById('examTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (examTimeLeft <= 0) {
                    clearInterval(examTimer);
                    alert('Ø²Ù…Ø§Ù† Ø¢Ø²Ù…ÙˆÙ† Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯!');
                    finishExam();
                }
            }, 1000);
        }
        
        function displayCurrentQuestion() {
            const question = currentExam.questions[currentQuestionIndex];
            const content = document.getElementById('examContent');
            
            content.innerHTML = `
                <div class="space-y-4">
                    <h4 class="text-lg font-bold text-white mb-4">${question.question}</h4>
                    <div class="space-y-3">
                        ${question.options.map((option, index) => `
                            <label class="flex items-center space-x-3 space-x-reverse p-3 bg-gray-700 rounded-lg hover:bg-gray-600 cursor-pointer transition-colors">
                                <input type="radio" name="answer" value="${index}" class="text-purple-500" ${userAnswers[currentQuestionIndex] === index ? 'checked' : ''} onchange="saveAnswer(${index})">
                                <span class="text-white">${option}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙˆØ§Ù„
            document.getElementById('currentQuestionNumber').textContent = currentQuestionIndex + 1;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishBtn');
            
            prevBtn.disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === currentExam.questions.length - 1) {
                nextBtn.classList.add('hidden');
                finishBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                finishBtn.classList.add('hidden');
            }
        }
        
        function saveAnswer(answerIndex) {
            userAnswers[currentQuestionIndex] = answerIndex;
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayCurrentQuestion();
            }
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < currentExam.questions.length - 1) {
                currentQuestionIndex++;
                displayCurrentQuestion();
            }
        }
        
        function finishExam() {
            clearInterval(examTimer);
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ù…Ø±Ù‡
            let correctAnswers = 0;
            for (let i = 0; i < currentExam.questions.length; i++) {
                if (userAnswers[i] === currentExam.questions[i].correct) {
                    correctAnswers++;
                }
            }
            
            const score = Math.round((correctAnswers / currentExam.questions.length) * 100);
            const passingScores = { bronze: 70, silver: 75, gold: 80 };
            const passed = score >= passingScores[currentExam.level];
            
            // Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡ Ø¢Ø²Ù…ÙˆÙ†
            const examResult = {
                id: Date.now().toString(),
                level: currentExam.level,
                field: currentExam.field,
                score: score,
                passed: passed,
                date: new Date().toISOString(),
                correctAnswers: correctAnswers,
                totalQuestions: currentExam.questions.length
            };
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±
            if (!currentUser.examResults) {
                currentUser.examResults = [];
            }
            currentUser.examResults.push(examResult);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¯Ø§Ù„ Ø¯Ø± ØµÙˆØ±Øª Ù‚Ø¨ÙˆÙ„ÛŒ
            if (passed) {
                if (!currentUser.medals) {
                    currentUser.medals = [];
                }
                
                if (!currentUser.medals.includes(currentExam.level)) {
                    currentUser.medals.push(currentExam.level);
                }
            }
            
            saveUserData();
            
            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
            document.getElementById('examModal').classList.add('hidden');
            
            if (passed) {
                alert(`ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ† Ù‚Ø¨ÙˆÙ„ Ø´Ø¯ÛŒØ¯!\n\nğŸ“Š Ù†Ù…Ø±Ù‡ Ø´Ù…Ø§: ${score}%\nğŸ¥‡ Ù…Ø¯Ø§Ù„ ${currentExam.level === 'bronze' ? 'Ø¨Ø±Ù†Ø²' : currentExam.level === 'silver' ? 'Ù†Ù‚Ø±Ù‡' : 'Ø·Ù„Ø§'} Ø¨Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø´Ù…Ø§ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯!`);
            } else {
                alert(`âŒ Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø¯Ø± Ø¢Ø²Ù…ÙˆÙ† Ù‚Ø¨ÙˆÙ„ Ù†Ø´Ø¯ÛŒØ¯.\n\nğŸ“Š Ù†Ù…Ø±Ù‡ Ø´Ù…Ø§: ${score}%\nğŸ“‹ Ù†Ù…Ø±Ù‡ Ù‚Ø¨ÙˆÙ„ÛŒ: ${passingScores[currentExam.level]}%\n\nÙ…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯!`);
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§
            updateMedalsDisplay();
            loadExamField();
        }
        
        function updateMedalsDisplay() {
            try {
                const medalsContainer = document.getElementById('userMedals');
                const profileMedalsContainer = document.getElementById('profileMedals');
                
                if (!currentUser || !currentUser.medals || currentUser.medals.length === 0) {
                    if (medalsContainer) {
                        medalsContainer.innerHTML = '<span class="text-gray-400 text-sm">Ù‡Ù†ÙˆØ² Ù…Ø¯Ø§Ù„ÛŒ Ú©Ø³Ø¨ Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯</span>';
                    }
                    if (profileMedalsContainer) {
                        profileMedalsContainer.innerHTML = '';
                    }
                    return;
                }
                
                const medalIcons = { bronze: 'ğŸ¥‰', silver: 'ğŸ¥ˆ', gold: 'ğŸ¥‡' };
                const medalNames = { bronze: 'Ø¨Ø±Ù†Ø²', silver: 'Ù†Ù‚Ø±Ù‡', gold: 'Ø·Ù„Ø§' };
                
                // Ø´Ù…Ø§Ø±Ø´ Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§
                const medalCounts = {};
                currentUser.medals.forEach(medal => {
                    medalCounts[medal] = (medalCounts[medal] || 0) + 1;
                });
                
                // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø¨Ø®Ø´ Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§
                if (medalsContainer) {
                    medalsContainer.innerHTML = Object.keys(medalCounts).map(medal => 
                        `<div class="flex items-center gap-1 bg-gray-700 px-3 py-1 rounded-full">
                            <span class="text-lg">${medalIcons[medal]}</span>
                            <span class="text-sm text-white">${medalNames[medal]}</span>
                            ${medalCounts[medal] > 1 ? `<span class="bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">${medalCounts[medal]}</span>` : ''}
                        </div>`
                    ).join('');
                }
                
                // Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆÛŒ ØªØµÙˆÛŒØ± Ù¾Ø±ÙˆÙØ§ÛŒÙ„
                if (profileMedalsContainer) {
                    profileMedalsContainer.innerHTML = Object.keys(medalCounts).map(medal => 
                        `<div class="relative">
                            <span class="text-lg">${medalIcons[medal]}</span>
                            ${medalCounts[medal] > 1 ? `<span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center text-[10px]">${medalCounts[medal]}</span>` : ''}
                        </div>`
                    ).join('');
                }
            } catch (error) {
                console.error('Error updating medals display:', error);
            }
        }
        
        function loadExamField() {
            try {
                const examFieldEl = document.getElementById('examField');
                if (examFieldEl && currentUser && currentUser.profile && currentUser.profile.examField) {
                    examFieldEl.value = currentUser.profile.examField;
                }
            } catch (error) {
                console.error('Error loading exam field:', error);
            }
        }
        
        // Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±
        function loadIdeaOwnerProjects() {
            const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
            const userProjects = escrowTransactions.filter(t => t.ideaOwnerId === currentUser.id);
            const projectsList = document.getElementById('ideaOwnerProjectsList');
            
            if (userProjects.length === 0) {
                projectsList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ“Š</div>
                        <h4 class="text-xl font-bold text-gray-400 mb-2">Ù‡Ù†ÙˆØ² Ù¾Ø±ÙˆÚ˜Ù‡â€ŒØ§ÛŒ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª</h4>
                        <p class="text-gray-500">Ù¾Ø³ Ø§Ø² Ø®Ø±ÛŒØ¯ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒØªØ§Ù†ØŒ Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                    </div>
                `;
                return;
            }
            
            projectsList.innerHTML = userProjects.map(project => {
                const statusColor = project.status === 'pending' ? 'bg-yellow-600' : 
                                  project.status === 'approved' ? 'bg-blue-600' : 
                                  project.status === 'released' ? 'bg-green-600' : 'bg-red-600';
                
                const statusText = project.status === 'pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ Ø´Ù…Ø§' : 
                                 project.status === 'approved' ? 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§' : 
                                 project.status === 'released' ? 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡' : 'Ù„ØºÙˆ Ø´Ø¯Ù‡';
                
                return `
                    <div class="bg-gray-800/50 backdrop-blur-lg rounded-xl p-6 border border-orange-500/30">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="text-xl font-bold text-orange-300">${project.ideaTitle}</h4>
                                <p class="text-gray-400">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±: ${project.investorName}</p>
                                <p class="text-gray-400">ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹: ${new Date(project.createdAt).toLocaleDateString('fa-IR')}</p>
                            </div>
                            <span class="${statusColor} text-xs px-3 py-1 rounded-full">${statusText}</span>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 text-center mb-4">
                            <div>
                                <p class="text-gray-400">Ù…Ø¨Ù„Øº Ù¾Ø±ÙˆÚ˜Ù‡</p>
                                <p class="text-white font-bold">${project.originalAmount.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Ú©Ø§Ø±Ù…Ø²Ø¯ Ø³Ø§ÛŒØª</p>
                                <p class="text-orange-400 font-bold">${project.platformFee.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Ø¯Ø±Ø¢Ù…Ø¯ Ø´Ù…Ø§</p>
                                <p class="text-green-400 font-bold">${project.originalAmount.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
                            </div>
                        </div>
                        
                        ${project.status === 'pending' ? `
                            <div class="bg-yellow-600/20 border border-yellow-500 rounded-lg p-4 mb-4">
                                <h5 class="font-bold text-yellow-300 mb-2">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ Ø´Ù…Ø§</h5>
                                <p class="text-yellow-200 text-sm mb-3">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø± Ø§ÛŒØ¯Ù‡ Ø´Ù…Ø§ Ø±Ø§ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ø±Ø¯Ù‡ Ùˆ Ù…Ù†ØªØ¸Ø± Ø´Ø±ÙˆØ¹ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø§Ø³Øª.</p>
                                <div class="flex gap-2">
                                    <button onclick="approveProject('${project.id}')" class="flex-1 bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors text-white">
                                        âœ… ØªØ§ÛŒÛŒØ¯ Ùˆ Ø´Ø±ÙˆØ¹ Ù‡Ù…Ú©Ø§Ø±ÛŒ
                                    </button>
                                    <button onclick="rejectProject('${project.id}')" class="flex-1 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors text-white">
                                        âŒ Ø±Ø¯ Ù‡Ù…Ú©Ø§Ø±ÛŒ
                                    </button>
                                </div>
                            </div>
                        ` : project.status === 'approved' ? `
                            <div class="bg-blue-600/20 border border-blue-500 rounded-lg p-4 mb-4">
                                <h5 class="font-bold text-blue-300 mb-2">ğŸš€ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§</h5>
                                <p class="text-blue-200 text-sm mb-3">Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø´Ù…Ø§ Ø¨Ø§ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø± Ø´Ø±ÙˆØ¹ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù¾Ø³ Ø§Ø² ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÚ˜Ù‡ØŒ Ù¾ÙˆÙ„ Ø¢Ø²Ø§Ø¯ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.</p>
                                <div class="flex gap-2">
                                    <button onclick="completeProject('${project.id}')" class="flex-1 bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors text-white">
                                        ğŸ‰ ØªÚ©Ù…ÛŒÙ„ Ù¾Ø±ÙˆÚ˜Ù‡ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ù¾ÙˆÙ„
                                    </button>
                                    <button onclick="openIdeaOwnerChat('${project.id}', '${project.investorName}', '${project.ideaTitle}')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors text-white">
                                        ğŸ’¬ Ú†Øª
                                    </button>
                                </div>
                            </div>
                        ` : project.status === 'released' ? `
                            <div class="bg-green-600/20 border border-green-500 rounded-lg p-4 mb-4">
                                <h5 class="font-bold text-green-300 mb-2">ğŸ‰ Ù¾Ø±ÙˆÚ˜Ù‡ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</h5>
                                <p class="text-green-200 text-sm mb-3">Ù¾ÙˆÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ ÙˆØ§Ø±ÛŒØ² Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
                                ${project.chatEnabled !== false ? `
                                    <button onclick="openIdeaOwnerChat('${project.id}', '${project.investorName}', '${project.ideaTitle}')" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors text-white">
                                        ğŸ’¬ Ú†Øª Ø¨Ø§ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±
                                    </button>
                                ` : `
                                    <div class="text-center text-green-300 text-sm">
                                        âœ… Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯
                                    </div>
                                `}
                            </div>
                        ` : `
                            <div class="bg-red-600/20 border border-red-500 rounded-lg p-4 text-center">
                                <h5 class="font-bold text-red-300 mb-2">âŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ù„ØºÙˆ Ø´Ø¯Ù‡</h5>
                                <p class="text-red-200 text-sm">Ø§ÛŒÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù„ØºÙˆ Ø´Ø¯Ù‡ Ùˆ Ù¾ÙˆÙ„ Ø¨Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø± Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
                            </div>
                        `}
                    </div>
                `;
            }).join('');
        }
        
        function approveProject(projectId) {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø±Ø§ ØªØ§ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯ØŸ\n\nÙ¾Ø³ Ø§Ø² ØªØ§ÛŒÛŒØ¯ØŒ Ù¾ÙˆÙ„ ÙÙˆØ±Ø§Ù‹ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ ÙˆØ§Ø±ÛŒØ² Ù…ÛŒâ€ŒØ´ÙˆØ¯.')) {
                const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
                const projectIndex = escrowTransactions.findIndex(t => t.id === projectId);
                
                if (projectIndex !== -1) {
                    const project = escrowTransactions[projectIndex];
                    
                    // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡ Ùˆ ÙˆØ§Ø±ÛŒØ² Ù¾ÙˆÙ„
                    escrowTransactions[projectIndex].status = 'released';
                    escrowTransactions[projectIndex].approvedAt = new Date().toISOString();
                    escrowTransactions[projectIndex].completedAt = new Date().toISOString();
                    localStorage.setItem('escrowTransactions', JSON.stringify(escrowTransactions));
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÙˆÙ„ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø± (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ)
                    if (!currentUser.wallet) {
                        currentUser.wallet = { balance: 0, transactions: [] };
                    }
                    
                    const transaction = {
                        id: Date.now().toString(),
                        type: 'income',
                        amount: project.originalAmount,
                        description: `ÙØ±ÙˆØ´ Ø§ÛŒØ¯Ù‡: ${project.ideaTitle}`,
                        date: new Date().toISOString(),
                        projectId: projectId
                    };
                    
                    currentUser.wallet.balance += project.originalAmount;
                    currentUser.wallet.transactions.push(transaction);
                    saveUserData();
                    
                    alert(`ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ù‡Ù…Ú©Ø§Ø±ÛŒ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯!\n\nğŸ’° Ù…Ø¨Ù„Øº ${project.originalAmount.toLocaleString()} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ ÙˆØ§Ø±ÛŒØ² Ø´Ø¯.\nğŸ’³ Ù…ÙˆØ¬ÙˆØ¯ÛŒ ÙØ¹Ù„ÛŒ: ${currentUser.wallet.balance.toLocaleString()} ØªÙˆÙ…Ø§Ù†\n\nÙ…Ù…Ù†ÙˆÙ† Ø§Ø² Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¹Ø§Ù„ÛŒâ€ŒØªØ§Ù†! ğŸ™`);
                    
                    loadIdeaOwnerProjects();
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø³Ø§ÛŒØ± Ø¨Ø®Ø´â€ŒÙ‡Ø§
                    loadIdeaOwnerChats();
                }
            }
        }
        
        function rejectProject(projectId) {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø±Ø§ Ø±Ø¯ Ú©Ù†ÛŒØ¯ØŸ\n\nÙ¾ÙˆÙ„ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø± Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯ Ùˆ Ø§Ù…Ú©Ø§Ù† Ú†Øª ØºÛŒØ±ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.')) {
                const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
                const projectIndex = escrowTransactions.findIndex(t => t.id === projectId);
                
                if (projectIndex !== -1) {
                    // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ùˆ ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú†Øª
                    escrowTransactions[projectIndex].status = 'cancelled';
                    escrowTransactions[projectIndex].rejectedAt = new Date().toISOString();
                    escrowTransactions[projectIndex].chatEnabled = false; // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú†Øª
                    localStorage.setItem('escrowTransactions', JSON.stringify(escrowTransactions));
                    
                    alert('âŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø±Ø¯ Ø´Ø¯!\n\nğŸ’° Ù¾ÙˆÙ„ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø± Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯.\nğŸ’¬ Ø§Ù…Ú©Ø§Ù† Ú†Øª ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯Ù‡ Ø§Ø³Øª.');
                    
                    loadIdeaOwnerProjects();
                    loadIdeaOwnerChats(); // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª Ú†Øªâ€ŒÙ‡Ø§
                }
            }
        }
        
        function completeProject(projectId) {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡ Ø§Ø³ØªØŸ\n\nÙ¾Ø³ Ø§Ø² ØªØ§ÛŒÛŒØ¯ØŒ Ù¾ÙˆÙ„ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ ÙˆØ§Ø±ÛŒØ² Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯ Ùˆ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ø³ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.')) {
                const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
                const projectIndex = escrowTransactions.findIndex(t => t.id === projectId);
                
                if (projectIndex !== -1) {
                    escrowTransactions[projectIndex].status = 'released';
                    escrowTransactions[projectIndex].completedAt = new Date().toISOString();
                    localStorage.setItem('escrowTransactions', JSON.stringify(escrowTransactions));
                    
                    const project = escrowTransactions[projectIndex];
                    alert(`ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ù¾Ø±ÙˆÚ˜Ù‡ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!\n\nğŸ’° Ù…Ø¨Ù„Øº ${project.originalAmount.toLocaleString()} ØªÙˆÙ…Ø§Ù† Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ ÙˆØ§Ø±ÛŒØ² Ø´Ø¯.\n\nÙ…Ù…Ù†ÙˆÙ† Ø§Ø² Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¹Ø§Ù„ÛŒâ€ŒØªØ§Ù†! ğŸ™`);
                    loadIdeaOwnerProjects();
                }
            }
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ú†Øª ÙˆØ§Ù‚Ø¹ÛŒ
        function loadIdeaOwnerChats() {
            const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
            // ÙÙ‚Ø· Ú†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ (chatEnabled !== false) Ùˆ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ
            const userChats = escrowTransactions.filter(t => 
                t.ideaOwnerId === currentUser.id && 
                t.chatEnabled !== false && 
                (t.status === 'pending' || t.status === 'approved' || t.status === 'released')
            );
            const chatList = document.getElementById('ideaOwnerChatList');
            
            if (userChats.length === 0) {
                chatList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ’¬</div>
                        <h4 class="text-xl font-bold text-gray-400 mb-2">Ù‡Ù†ÙˆØ² Ú†ØªÛŒ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª</h4>
                        <p class="text-gray-500">Ù¾Ø³ Ø§Ø² Ø®Ø±ÛŒØ¯ Ø§ÛŒØ¯Ù‡ ØªÙˆØ³Ø· Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±Ø§Ù†ØŒ Ú†Øª ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                    </div>
                `;
                return;
            }
            
            chatList.innerHTML = userChats.map(chat => {
                const lastMessage = getLastMessage(chat.id);
                const statusColor = chat.status === 'pending' ? 'bg-yellow-600' : 
                                  chat.status === 'approved' ? 'bg-blue-600' : 
                                  chat.status === 'released' ? 'bg-green-600' : 'bg-gray-600';
                
                const statusText = chat.status === 'pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯' : 
                                 chat.status === 'approved' ? 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§' : 
                                 chat.status === 'released' ? 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡' : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                
                return `
                    <div class="bg-gray-800/50 backdrop-blur-lg rounded-xl p-4 border border-green-500/30">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center gap-2">
                                <h4 class="font-bold text-green-300">${chat.investorName}</h4>
                                <button onclick="viewInvestorProfile('${chat.investorId}')" class="bg-purple-600 hover:bg-purple-700 px-2 py-1 rounded text-xs transition-colors">ğŸ‘¤</button>
                            </div>
                            <div class="flex flex-col items-end gap-1">
                                <span class="text-xs text-gray-400">${new Date(chat.createdAt).toLocaleDateString('fa-IR')}</span>
                                <span class="${statusColor} text-xs px-2 py-1 rounded-full">${statusText}</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-400 mb-2">Ø§ÛŒØ¯Ù‡: ${chat.ideaTitle}</p>
                        ${lastMessage ? `<p class="text-sm text-gray-300 truncate">${lastMessage}</p>` : '<p class="text-sm text-gray-500">Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡</p>'}
                        <div class="mt-2">
                            <button onclick="openIdeaOwnerChat('${chat.id}', '${chat.investorName}', '${chat.ideaTitle}')" class="w-full bg-green-600 hover:bg-green-700 px-3 py-2 rounded-lg transition-colors text-sm">
                                ğŸ’¬ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ú†Øª
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function openIdeaOwnerChat(escrowId, investorName, ideaTitle) {
            const chatWindow = document.getElementById('ideaOwnerChatWindow');
            const chatTitle = document.getElementById('ideaOwnerChatTitle');
            const chatMessages = document.getElementById('ideaOwnerChatMessages');
            
            chatTitle.textContent = `Ú†Øª Ø¨Ø§ ${investorName} - ${ideaTitle}`;
            chatWindow.classList.remove('hidden');
            chatWindow.dataset.escrowId = escrowId;
            
            loadChatMessages(escrowId, chatMessages);
        }
        
        function closeIdeaOwnerChat() {
            document.getElementById('ideaOwnerChatWindow').classList.add('hidden');
        }
        
        function sendIdeaOwnerMessage() {
            const input = document.getElementById('ideaOwnerChatInput');
            const escrowId = document.getElementById('ideaOwnerChatWindow').dataset.escrowId;
            const messagesContainer = document.getElementById('ideaOwnerChatMessages');
            
            if (input.value.trim() && escrowId) {
                const message = input.value.trim();
                
                const messageObj = {
                    id: Date.now().toString(),
                    senderId: currentUser.id,
                    senderName: currentUser.name,
                    message: message,
                    timestamp: new Date().toISOString(),
                    escrowId: escrowId
                };
                
                // Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…
                const chatHistory = JSON.parse(localStorage.getItem('chatHistory_' + escrowId)) || [];
                chatHistory.push(messageObj);
                localStorage.setItem('chatHistory_' + escrowId, JSON.stringify(chatHistory));
                
                // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex justify-end mb-4';
                messageDiv.innerHTML = `
                    <div class="bg-green-600 rounded-lg p-3 max-w-xs">
                        <p class="text-white">${message}</p>
                        <p class="text-xs text-green-200 mt-1">${new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</p>
                    </div>
                `;
                messagesContainer.appendChild(messageDiv);
                input.value = '';
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±
                showChatNotification('investor');
            }
        }
        
        function loadChatMessages(escrowId, container) {
            const chatHistory = JSON.parse(localStorage.getItem('chatHistory_' + escrowId)) || [];
            
            if (chatHistory.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-4">
                        <p class="text-sm">Ú†Øª Ø´Ø±ÙˆØ¹ Ø´Ø¯ ğŸ’¬</p>
                        <p class="text-xs mt-1">Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯</p>
                    </div>
                `;
            } else {
                const messagesHtml = chatHistory.map(msg => {
                    const isCurrentUser = msg.senderId === currentUser.id;
                    return `
                        <div class="flex ${isCurrentUser ? 'justify-end' : 'justify-start'} mb-4">
                            <div class="${isCurrentUser ? 'bg-green-600' : 'bg-blue-600'} rounded-lg p-3 max-w-xs">
                                <p class="text-white">${msg.message}</p>
                                <p class="text-xs ${isCurrentUser ? 'text-green-200' : 'text-blue-200'} mt-1">${new Date(msg.timestamp).toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = messagesHtml;
            }
            
            container.scrollTop = container.scrollHeight;
        }
        
        function getLastMessage(escrowId) {
            const chatHistory = JSON.parse(localStorage.getItem('chatHistory_' + escrowId)) || [];
            if (chatHistory.length === 0) return null;
            
            const lastMessage = chatHistory[chatHistory.length - 1];
            return lastMessage.message.length > 30 ? lastMessage.message.substring(0, 30) + '...' : lastMessage.message;
        }
        
        function saveUserData() {
            try {
                if (!currentUser || !currentUserType) return;
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ù…Ø­Ù„ÛŒ
                const users = JSON.parse(localStorage.getItem('platformUsers')) || { ideaOwner: [], investor: [] };
                const userList = users[currentUserType] || [];
                const userIndex = userList.findIndex(u => u.id === currentUser.id);
                
                if (userIndex !== -1) {
                    userList[userIndex] = currentUser;
                    users[currentUserType] = userList;
                    localStorage.setItem('platformUsers', JSON.stringify(users));
                    saveUserSession();
                }
            } catch (error) {
                console.error('Error saving user data:', error);
            }
        }
        
        function viewIdeaDetailsForPurchase(ideaId) {
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú©
            const ideas = loadIdeasFromCloud();
            const idea = ideas.find(i => i.id === ideaId);
            
            if (!idea) return;
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„ Ø®Ø±ÛŒØ¯
            const modal = document.getElementById('purchaseModal');
            modal.dataset.ideaId = ideaId;
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆØ¯Ø§Ù„
            modal.querySelector('h4').textContent = idea.title;
            modal.querySelector('.text-2xl').textContent = `${idea.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
            
            modal.classList.remove('hidden');
        }
        
        function showPurchaseModal() {
            document.getElementById('purchaseModal').classList.remove('hidden');
        }
        
        function editProfile() {
            showProfileEditModal('ideaOwner');
        }
        
        function editInvestorProfile() {
            showProfileEditModal('investor');
        }
        
        function showProfileEditModal(userType) {
            const modal = document.createElement('div');
            modal.id = 'profileEditModal';
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50';
            
            const profile = currentUser.profile || {};
            
            if (userType === 'ideaOwner') {
                modal.innerHTML = `
                    <div class="bg-gray-800 rounded-xl p-8 max-w-md w-full border border-purple-500/30">
                        <h3 class="text-2xl font-bold text-purple-300 mb-6 text-center">ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-300 mb-2">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                                <input type="text" id="editName" value="${currentUser.name || ''}" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">ØªØ®ØµØµ</label>
                                <input type="text" id="editSpecialty" value="${profile.specialty || ''}" placeholder="Ù…Ø«Ø§Ù„: ØªÙˆØ³Ø¹Ù‡ Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</label>
                                <input type="tel" id="editPhone" value="${profile.phone || ''}" placeholder="09123456789" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">Ø´Ù‡Ø±</label>
                                <input type="text" id="editCity" value="${profile.city || ''}" placeholder="ØªÙ‡Ø±Ø§Ù†" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">Ø³Ø§Ø¨Ù‚Ù‡ Ú©Ø§Ø± (Ø³Ø§Ù„)</label>
                                <input type="number" id="editExperience" value="${profile.experience || ''}" placeholder="5" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ù†</label>
                                <textarea id="editBio" rows="3" placeholder="ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø®ÙˆØ¯ØªØ§Ù†..." class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white resize-none">${profile.bio || ''}</textarea>
                            </div>
                        </div>
                        <div class="flex gap-4 mt-6">
                            <button onclick="closeProfileEditModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg transition-colors">Ø§Ù†ØµØ±Ø§Ù</button>
                            <button onclick="saveProfile('ideaOwner')" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg transition-colors">Ø°Ø®ÛŒØ±Ù‡</button>
                        </div>
                    </div>
                `;
            } else {
                modal.innerHTML = `
                    <div class="bg-gray-800 rounded-xl p-8 max-w-md w-full border border-blue-500/30">
                        <h3 class="text-2xl font-bold text-blue-300 mb-6 text-center">ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-300 mb-2">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
                                <input type="text" id="editName" value="${currentUser.name || ''}" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†</label>
                                <input type="tel" id="editPhone" value="${profile.phone || ''}" placeholder="09123456789" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">Ø´Ù‡Ø±</label>
                                <input type="text" id="editCity" value="${profile.city || ''}" placeholder="ØªÙ‡Ø±Ø§Ù†" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">Ø¨ÙˆØ¯Ø¬Ù‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</label>
                                <select id="editBudget" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white">
                                    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
                                    <option value="Ú©Ù…ØªØ± Ø§Ø² 10 Ù…ÛŒÙ„ÛŒÙˆÙ†" ${profile.budget === 'Ú©Ù…ØªØ± Ø§Ø² 10 Ù…ÛŒÙ„ÛŒÙˆÙ†' ? 'selected' : ''}>Ú©Ù…ØªØ± Ø§Ø² 10 Ù…ÛŒÙ„ÛŒÙˆÙ†</option>
                                    <option value="10 ØªØ§ 50 Ù…ÛŒÙ„ÛŒÙˆÙ†" ${profile.budget === '10 ØªØ§ 50 Ù…ÛŒÙ„ÛŒÙˆÙ†' ? 'selected' : ''}>10 ØªØ§ 50 Ù…ÛŒÙ„ÛŒÙˆÙ†</option>
                                    <option value="50 ØªØ§ 100 Ù…ÛŒÙ„ÛŒÙˆÙ†" ${profile.budget === '50 ØªØ§ 100 Ù…ÛŒÙ„ÛŒÙˆÙ†' ? 'selected' : ''}>50 ØªØ§ 100 Ù…ÛŒÙ„ÛŒÙˆÙ†</option>
                                    <option value="Ø¨ÛŒØ´ Ø§Ø² 100 Ù…ÛŒÙ„ÛŒÙˆÙ†" ${profile.budget === 'Ø¨ÛŒØ´ Ø§Ø² 100 Ù…ÛŒÙ„ÛŒÙˆÙ†' ? 'selected' : ''}>Ø¨ÛŒØ´ Ø§Ø² 100 Ù…ÛŒÙ„ÛŒÙˆÙ†</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-300 mb-2">Ø¹Ù„Ø§ÛŒÙ‚ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</label>
                                <textarea id="editInterests" rows="3" placeholder="Ù…Ø«Ø§Ù„: ÙÙ†Ø§ÙˆØ±ÛŒØŒ Ú©Ø³Ø¨ Ùˆ Ú©Ø§Ø±ØŒ Ø³Ù„Ø§Ù…Øª..." class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white resize-none">${profile.interests || ''}</textarea>
                            </div>
                        </div>
                        <div class="flex gap-4 mt-6">
                            <button onclick="closeProfileEditModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg transition-colors">Ø§Ù†ØµØ±Ø§Ù</button>
                            <button onclick="saveProfile('investor')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-colors">Ø°Ø®ÛŒØ±Ù‡</button>
                        </div>
                    </div>
                `;
            }
            
            document.body.appendChild(modal);
        }
        
        function closeProfileEditModal() {
            const modal = document.getElementById('profileEditModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function saveProfile(userType) {
            const name = document.getElementById('editName').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            const city = document.getElementById('editCity').value.trim();
            
            if (!name) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø±
            currentUser.name = name;
            
            if (!currentUser.profile) {
                currentUser.profile = {};
            }
            
            currentUser.profile.phone = phone;
            currentUser.profile.city = city;
            
            if (userType === 'ideaOwner') {
                const specialty = document.getElementById('editSpecialty').value.trim();
                const experience = document.getElementById('editExperience').value.trim();
                const bio = document.getElementById('editBio').value.trim();
                
                currentUser.profile.specialty = specialty;
                currentUser.profile.experience = experience;
                currentUser.profile.bio = bio;
            } else {
                const budget = document.getElementById('editBudget').value;
                const interests = document.getElementById('editInterests').value.trim();
                
                currentUser.profile.budget = budget;
                currentUser.profile.interests = interests;
            }
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            const users = JSON.parse(localStorage.getItem('platformUsers')) || { ideaOwner: [], investor: [] };
            const userList = users[currentUserType] || [];
            const userIndex = userList.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                userList[userIndex] = currentUser;
                users[currentUserType] = userList;
                localStorage.setItem('platformUsers', JSON.stringify(users));
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¬Ù„Ø³Ù‡ Ú©Ø§Ø±Ø¨Ø±
                saveUserSession();
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
            if (userType === 'ideaOwner') {
                updateUserProfile();
            } else {
                updateInvestorProfile();
            }
            
            closeProfileEditModal();
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            successDiv.textContent = 'âœ… Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯!';
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }
        
        function editIdea(ideaId) {
            alert('ÙˆÛŒØ±Ø§ÛŒØ´ Ø§ÛŒØ¯Ù‡ - Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø¯Ø± Ù†Ø³Ø®Ù‡ Ø¨Ø¹Ø¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯');
        }
        
        function filterIdeas() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú©
            const ideas = loadIdeasFromCloud();
            let filteredIdeas = ideas.filter(idea => idea.status === 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡' && idea.ownerId !== currentUser.id);
            
            if (categoryFilter) {
                filteredIdeas = filteredIdeas.filter(idea => idea.category === categoryFilter);
            }
            
            const container = document.getElementById('availableIdeasContainer');
            
            if (filteredIdeas.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ”</div>
                        <h4 class="text-xl font-bold text-gray-400 mb-2">Ø§ÛŒØ¯Ù‡â€ŒØ§ÛŒ Ø¨Ø§ Ø§ÛŒÙ† ÙÛŒÙ„ØªØ±Ù‡Ø§ ÛŒØ§ÙØª Ù†Ø´Ø¯</h4>
                        <p class="text-gray-500">ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ ÛŒØ§ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredIdeas.map(idea => {
                // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±
                const medalIcons = { bronze: 'ğŸ¥‰', silver: 'ğŸ¥ˆ', gold: 'ğŸ¥‡' };
                const medalsHtml = idea.ownerMedals && idea.ownerMedals.length > 0 ? 
                    idea.ownerMedals.map(medal => `<span class="text-lg">${medalIcons[medal]}</span>`).join('') : '';
                
                return `
                    <div class="bg-gray-800/50 backdrop-blur-lg rounded-xl p-6 border border-purple-500/30 card-hover">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="flex items-center gap-2 mb-2">
                                    <h4 class="text-xl font-bold text-purple-300">${idea.title}</h4>
                                    ${medalsHtml ? `<div class="flex gap-1">${medalsHtml}</div>` : ''}
                                </div>
                                <p class="text-gray-400">Ø¯Ø³ØªÙ‡: ${idea.category} | Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±: ${idea.ownerName}</p>
                            </div>
                        </div>
                        <p class="text-gray-300 mb-4">${idea.description.substring(0, 150)}...</p>
                        <div class="flex justify-between items-center">
                            <div class="ai-indicator text-xs px-3 py-1 rounded-full text-white">
                                ğŸ¤– ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                            </div>
                            <div class="flex gap-2">
                                <span class="text-green-400 font-bold">${idea.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†</span>
                                <button onclick="viewOwnerProfile('${idea.ownerId}')" class="bg-purple-600 hover:bg-purple-700 px-3 py-2 rounded-lg transition-colors text-sm">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
                                <button onclick="viewIdeaDetailsForPurchase('${idea.id}')" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function showPaymentDetails(method) {
            const paymentDetails = document.getElementById('paymentDetails');
            const fiatPayment = document.getElementById('fiatPayment');
            const cryptoPayment = document.getElementById('cryptoPayment');
            
            paymentDetails.classList.remove('hidden');
            
            if (method === 'fiat') {
                fiatPayment.classList.remove('hidden');
                cryptoPayment.classList.add('hidden');
            } else {
                fiatPayment.classList.add('hidden');
                cryptoPayment.classList.remove('hidden');
            }
        }
        
        function closePurchaseModal() {
            document.getElementById('purchaseModal').classList.add('hidden');
            
            // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ±Ù… Ù¾Ø±Ø¯Ø§Ø®Øª
            const paymentDetails = document.getElementById('paymentDetails');
            const fiatPayment = document.getElementById('fiatPayment');
            const cryptoPayment = document.getElementById('cryptoPayment');
            
            paymentDetails.classList.add('hidden');
            fiatPayment.classList.add('hidden');
            cryptoPayment.classList.add('hidden');
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª
            const paymentRadios = document.querySelectorAll('input[name="payment"]');
            paymentRadios.forEach(radio => radio.checked = false);
        }
        
        function processPurchase() {
            const paymentMethod = document.querySelector('input[name="payment"]:checked');
            if (!paymentMethod) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            const currentIdeaId = document.getElementById('purchaseModal').dataset.ideaId;
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ù…Ø´ØªØ±Ú©
            const ideas = loadIdeasFromCloud();
            const idea = ideas.find(i => i.id === currentIdeaId);
            
            if (!idea) {
                alert('Ø®Ø·Ø§ Ø¯Ø± ÛŒØ§ÙØªÙ† Ø§ÛŒØ¯Ù‡');
                return;
            }
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¨Ù„Øº Ú©Ù„ (Ù‚ÛŒÙ…Øª + 10% Ú©Ø§Ø±Ù…Ø²Ø¯)
            const totalAmount = Math.round(idea.price * 1.1);
            const platformFee = totalAmount - idea.price;
            
            // Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´ Ø§Ù…Ø§Ù†ÛŒ
            const escrowTransaction = {
                id: Date.now().toString(),
                ideaId: idea.id,
                ideaTitle: idea.title,
                ideaOwnerId: idea.ownerId,
                ideaOwnerName: idea.ownerName,
                investorId: currentUser.id,
                investorName: currentUser.name,
                originalAmount: idea.price,
                platformFee: platformFee,
                totalAmount: totalAmount,
                status: 'pending', // pending, approved, released, cancelled
                createdAt: new Date().toISOString(),
                paymentMethod: paymentMethod.value,
                chatEnabled: true
            };
            
            // Ø°Ø®ÛŒØ±Ù‡ ØªØ±Ø§Ú©Ù†Ø´ Ø§Ù…Ø§Ù†ÛŒ
            const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
            escrowTransactions.push(escrowTransaction);
            localStorage.setItem('escrowTransactions', JSON.stringify(escrowTransactions));
            
            // Ø«Ø¨Øª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ
            const investment = {
                id: Date.now().toString(),
                ideaId: idea.id,
                ideaTitle: idea.title,
                amount: totalAmount,
                originalAmount: idea.price,
                platformFee: platformFee,
                purchaseDate: new Date().toISOString(),
                paymentMethod: paymentMethod.value,
                status: 'escrow', // escrow, active, completed
                escrowId: escrowTransaction.id
            };
            
            const userInvestments = JSON.parse(localStorage.getItem('userInvestments_' + currentUser.id)) || [];
            userInvestments.push(investment);
            localStorage.setItem('userInvestments_' + currentUser.id, JSON.stringify(userInvestments));
            
            alert(`âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!\n\nğŸ’° Ù…Ø¨Ù„Øº Ú©Ù„: ${totalAmount.toLocaleString()} ØªÙˆÙ…Ø§Ù†\nğŸ’¡ Ù‚ÛŒÙ…Øª Ø§ÛŒØ¯Ù‡: ${idea.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†\nğŸ¦ Ú©Ø§Ø±Ù…Ø²Ø¯ Ø³Ø§ÛŒØª: ${platformFee.toLocaleString()} ØªÙˆÙ…Ø§Ù†\n\nğŸ”’ Ù¾ÙˆÙ„ Ø¯Ø± ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù…Ø§Ù†Ø§Øª Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯\nğŸ’¬ Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ø¨Ø§ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø± Ú†Øª Ú©Ù†ÛŒØ¯!`);
            
            closePurchaseModal();
            
            // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ùˆ Ù†Ù…Ø§ÛŒØ´ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù…Ø§Ù†Ø§Øª
            showInvestorSection('escrow');
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§
            loadEscrowTransactions();
            loadUserInvestments();
            loadInvestorChats();
        }
        
        function loadEscrowTransactions() {
            const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
            const userTransactions = escrowTransactions.filter(t => t.investorId === currentUser.id);
            const container = document.getElementById('escrowTransactionsContainer');
            
            if (userTransactions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ¦</div>
                        <h4 class="text-xl font-bold text-gray-400 mb-2">Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ Ø§Ù…Ø§Ù†ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</h4>
                        <p class="text-gray-500">Ù¾Ø³ Ø§Ø² Ø®Ø±ÛŒØ¯ Ø§ÛŒØ¯Ù‡ØŒ Ù¾ÙˆÙ„ Ø¯Ø± ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù…Ø§Ù†Ø§Øª Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = userTransactions.map(transaction => {
                const statusColor = transaction.status === 'pending' ? 'bg-yellow-600' : 
                                  transaction.status === 'approved' ? 'bg-blue-600' : 
                                  transaction.status === 'released' ? 'bg-green-600' : 'bg-red-600';
                
                const statusText = transaction.status === 'pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯' : 
                                 transaction.status === 'approved' ? 'ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡' : 
                                 transaction.status === 'released' ? 'Ø¢Ø²Ø§Ø¯ Ø´Ø¯Ù‡' : 'Ù„ØºÙˆ Ø´Ø¯Ù‡';
                
                return `
                    <div class="bg-gray-800/50 backdrop-blur-lg rounded-xl p-6 border border-blue-500/30">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h4 class="text-xl font-bold text-blue-300">${transaction.ideaTitle}</h4>
                                <p class="text-gray-400">Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±: ${transaction.ideaOwnerName}</p>
                                <p class="text-gray-400">ØªØ§Ø±ÛŒØ®: ${new Date(transaction.createdAt).toLocaleDateString('fa-IR')}</p>
                            </div>
                            <span class="${statusColor} text-xs px-3 py-1 rounded-full">${statusText}</span>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-center mb-4">
                            <div>
                                <p class="text-gray-400">Ù‚ÛŒÙ…Øª Ø§ÛŒØ¯Ù‡</p>
                                <p class="text-white font-bold">${transaction.originalAmount.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Ú©Ø§Ø±Ù…Ø²Ø¯ Ø³Ø§ÛŒØª</p>
                                <p class="text-orange-400 font-bold">${transaction.platformFee.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
                            </div>
                            <div>
                                <p class="text-gray-400">Ù…Ø¨Ù„Øº Ú©Ù„</p>
                                <p class="text-green-400 font-bold">${transaction.totalAmount.toLocaleString()} ØªÙˆÙ…Ø§Ù†</p>
                            </div>
                        </div>
                        ${transaction.status === 'pending' ? `
                            <div class="flex gap-2">
                                <button onclick="approveEscrow('${transaction.id}')" class="flex-1 bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors">ØªØ§ÛŒÛŒØ¯ Ù‡Ù…Ú©Ø§Ø±ÛŒ</button>
                                <button onclick="cancelEscrow('${transaction.id}')" class="flex-1 bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors">Ù„ØºÙˆ</button>
                            </div>
                        ` : transaction.status === 'approved' ? `
                            <div class="bg-blue-600/20 border border-blue-500 rounded-lg p-3 text-blue-300 text-sm text-center">
                                âœ… Ù‡Ù…Ú©Ø§Ø±ÛŒ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡ - Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù¾ÙˆÙ„
                            </div>
                        ` : transaction.status === 'released' ? `
                            <div class="bg-green-600/20 border border-green-500 rounded-lg p-3 text-green-300 text-sm text-center">
                                ğŸ‰ Ù¾Ø±ÙˆÚ˜Ù‡ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡ - Ù¾ÙˆÙ„ Ø¢Ø²Ø§Ø¯ Ø´Ø¯Ù‡
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ú†Øª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±
        function loadInvestorChats() {
            const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
            // ÙÙ‚Ø· Ú†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ (chatEnabled !== false) Ùˆ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ
            const userChats = escrowTransactions.filter(t => 
                t.investorId === currentUser.id && 
                t.chatEnabled !== false && 
                (t.status === 'pending' || t.status === 'approved' || t.status === 'released')
            );
            const chatList = document.getElementById('investorChatList');
            
            if (userChats.length === 0) {
                chatList.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">ğŸ’¬</div>
                        <h4 class="text-xl font-bold text-gray-400 mb-2">Ù‡Ù†ÙˆØ² Ú†ØªÛŒ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª</h4>
                        <p class="text-gray-500">Ù¾Ø³ Ø§Ø² Ø®Ø±ÛŒØ¯ Ø§ÛŒØ¯Ù‡ØŒ Ú†Øª Ø¨Ø§ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø± ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                    </div>
                `;
                return;
            }
            
            chatList.innerHTML = userChats.map(chat => {
                const lastMessage = getLastMessage(chat.id);
                const statusColor = chat.status === 'pending' ? 'bg-yellow-600' : 
                                  chat.status === 'approved' ? 'bg-blue-600' : 
                                  chat.status === 'released' ? 'bg-green-600' : 'bg-gray-600';
                
                const statusText = chat.status === 'pending' ? 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯' : 
                                 chat.status === 'approved' ? 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§' : 
                                 chat.status === 'released' ? 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡' : 'Ù†Ø§Ù…Ø´Ø®Øµ';
                
                return `
                    <div class="bg-gray-800/50 backdrop-blur-lg rounded-xl p-4 border border-green-500/30">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center gap-2">
                                <h4 class="font-bold text-green-300">${chat.ideaOwnerName}</h4>
                                <button onclick="viewOwnerProfile('${chat.ideaOwnerId}')" class="bg-purple-600 hover:bg-purple-700 px-2 py-1 rounded text-xs transition-colors">ğŸ‘¤</button>
                            </div>
                            <div class="flex flex-col items-end gap-1">
                                <span class="text-xs text-gray-400">${new Date(chat.createdAt).toLocaleDateString('fa-IR')}</span>
                                <span class="${statusColor} text-xs px-2 py-1 rounded-full">${statusText}</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-400 mb-2">Ø§ÛŒØ¯Ù‡: ${chat.ideaTitle}</p>
                        ${lastMessage ? `<p class="text-sm text-gray-300 truncate">${lastMessage}</p>` : '<p class="text-sm text-gray-500">Ù‡Ù†ÙˆØ² Ù¾ÛŒØ§Ù…ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù†Ø´Ø¯Ù‡</p>'}
                        <div class="mt-2">
                            <button onclick="openInvestorChat('${chat.id}', '${chat.ideaOwnerName}', '${chat.ideaTitle}')" class="w-full bg-green-600 hover:bg-green-700 px-3 py-2 rounded-lg transition-colors text-sm">
                                ğŸ’¬ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ú†Øª
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function openInvestorChat(escrowId, ideaOwnerName, ideaTitle) {
            const chatWindow = document.getElementById('investorChatWindow');
            const chatTitle = document.getElementById('investorChatTitle');
            const chatMessages = document.getElementById('investorChatMessages');
            
            chatTitle.textContent = `Ú†Øª Ø¨Ø§ ${ideaOwnerName} - ${ideaTitle}`;
            chatWindow.classList.remove('hidden');
            chatWindow.dataset.escrowId = escrowId;
            
            loadChatMessages(escrowId, chatMessages);
        }
        
        function closeInvestorChat() {
            document.getElementById('investorChatWindow').classList.add('hidden');
        }
        
        function sendInvestorMessage() {
            const input = document.getElementById('investorChatInput');
            const escrowId = document.getElementById('investorChatWindow').dataset.escrowId;
            const messagesContainer = document.getElementById('investorChatMessages');
            
            if (input.value.trim() && escrowId) {
                const message = input.value.trim();
                
                const messageObj = {
                    id: Date.now().toString(),
                    senderId: currentUser.id,
                    senderName: currentUser.name,
                    message: message,
                    timestamp: new Date().toISOString(),
                    escrowId: escrowId
                };
                
                // Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…
                const chatHistory = JSON.parse(localStorage.getItem('chatHistory_' + escrowId)) || [];
                chatHistory.push(messageObj);
                localStorage.setItem('chatHistory_' + escrowId, JSON.stringify(chatHistory));
                
                // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex justify-end mb-4';
                messageDiv.innerHTML = `
                    <div class="bg-blue-600 rounded-lg p-3 max-w-xs">
                        <p class="text-white">${message}</p>
                        <p class="text-xs text-blue-200 mt-1">${new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</p>
                    </div>
                `;
                messagesContainer.appendChild(messageDiv);
                input.value = '';
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±
                showChatNotification('ideaOwner');
            }
        }
        
        function enableInvestorChat(escrowId) {
            // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø¯ÛŒÚ¯Ø± Ù†ÛŒØ§Ø² Ù†ÛŒØ³Øª Ú†ÙˆÙ† Ú†Øª Ø§Ø² Ø·Ø±ÛŒÙ‚ loadInvestorChats Ù…Ø¯ÛŒØ±ÛŒØª Ù…ÛŒâ€ŒØ´ÙˆØ¯
            loadInvestorChats();
        }
        
        function sendChatMessage(userType, escrowId) {
            let input, messagesContainer;
            
            if (userType === 'investor') {
                input = document.getElementById('investorChatInput');
                messagesContainer = document.getElementById('chatMessagesContainer');
            } else {
                input = document.getElementById('ideaOwnerChatInput');
                messagesContainer = document.getElementById('chatMessagesContainer');
            }
            
            if (input && !input.disabled) {
                const message = input.value.trim();
                if (message) {
                    const messageObj = {
                        id: Date.now().toString(),
                        senderId: currentUser.id,
                        senderName: currentUser.name,
                        message: message,
                        timestamp: new Date().toISOString(),
                        escrowId: escrowId
                    };
                    
                    // Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ§Ù…
                    const chatHistory = JSON.parse(localStorage.getItem('chatHistory_' + escrowId)) || [];
                    chatHistory.push(messageObj);
                    localStorage.setItem('chatHistory_' + escrowId, JSON.stringify(chatHistory));
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'flex justify-end mb-4';
                    messageDiv.innerHTML = `
                        <div class="bg-green-600 rounded-lg p-3 max-w-xs">
                            <p class="text-white">${message}</p>
                            <p class="text-xs text-green-200 mt-1">${new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</p>
                        </div>
                    `;
                    messagesContainer.appendChild(messageDiv);
                    input.value = '';
                    messagesContainer.parentElement.scrollTop = messagesContainer.parentElement.scrollHeight;
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ø¨Ø±Ø§ÛŒ Ø·Ø±Ù Ù…Ù‚Ø§Ø¨Ù„
                    if (userType === 'investor') {
                        showChatNotification('ideaOwner');
                    } else {
                        showChatNotification('investor');
                    }
                }
            }
        }
        
        function getAutoReply(message) {
            const replies = [
                'Ù…Ù…Ù†ÙˆÙ† Ø§Ø² Ù¾ÛŒØ§Ù…ØªÙˆÙ†! Ø¨Ø²ÙˆØ¯ÛŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ±ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ù… ğŸ“‹',
                'Ø³Ù„Ø§Ù…! Ø®ÙˆØ´Ø­Ø§Ù„Ù… Ú©Ù‡ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ…Ù†Ø¯ Ù‡Ø³ØªÛŒØ¯. Ú†Ù‡ Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŸ ğŸ¤”',
                'Ø¹Ø§Ù„ÛŒÙ‡! Ø¨ÛŒØ§ÛŒÛŒØ¯ Ø¯Ø± Ù…ÙˆØ±Ø¯ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¨ÛŒØ´ØªØ± ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ… ğŸ’¡',
                'Ù…Ù…Ù†ÙˆÙ† Ø§Ø² Ø§Ø¹ØªÙ…Ø§Ø¯ØªÙˆÙ†. Ø¢Ù…Ø§Ø¯Ù‡ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù‡Ø³ØªÙ…! ğŸ¤',
                'Ø³ÙˆØ§Ù„ Ø®ÙˆØ¨ÛŒ Ù¾Ø±Ø³ÛŒØ¯ÛŒØ¯. Ø¨Ø°Ø§Ø±ÛŒØ¯ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù…... ğŸ“'
            ];
            return replies[Math.floor(Math.random() * replies.length)];
        }
        
        function approveEscrow(escrowId) {
            const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
            const transactionIndex = escrowTransactions.findIndex(t => t.id === escrowId);
            
            if (transactionIndex !== -1) {
                escrowTransactions[transactionIndex].status = 'approved';
                localStorage.setItem('escrowTransactions', JSON.stringify(escrowTransactions));
                
                alert('âœ… Ù‡Ù…Ú©Ø§Ø±ÛŒ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯!\n\nØ­Ø§Ù„Ø§ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø¢Ø²Ø§Ø¯Ø³Ø§Ø²ÛŒ Ù¾ÙˆÙ„ Ù‡Ø³ØªÛŒÙ….');
                loadEscrowTransactions();
            }
        }
        
        function cancelEscrow(escrowId) {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§ÛŒÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø±Ø§ Ù„ØºÙˆ Ú©Ù†ÛŒØ¯ØŸ\n\nÙ¾ÙˆÙ„ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.')) {
                const escrowTransactions = JSON.parse(localStorage.getItem('escrowTransactions')) || [];
                const transactionIndex = escrowTransactions.findIndex(t => t.id === escrowId);
                
                if (transactionIndex !== -1) {
                    escrowTransactions[transactionIndex].status = 'cancelled';
                    localStorage.setItem('escrowTransactions', JSON.stringify(escrowTransactions));
                    
                    alert('âŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù„ØºÙˆ Ø´Ø¯!\n\nÙ¾ÙˆÙ„ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯.');
                    loadEscrowTransactions();
                }
            }
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ú†Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
        function toggleSupportChat() {
            const chatWindow = document.getElementById('supportChatWindow');
            chatWindow.classList.toggle('hidden');
        }
        
        function askPredefinedQuestion(question) {
            const messagesContainer = document.getElementById('supportChatMessages');
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³ÙˆØ§Ù„ Ú©Ø§Ø±Ø¨Ø±
            const userMessage = document.createElement('div');
            userMessage.className = 'flex justify-end';
            userMessage.innerHTML = `
                <div class="bg-purple-600 rounded-lg p-3 max-w-xs">
                    <p class="text-white text-sm">${question}</p>
                </div>
            `;
            messagesContainer.appendChild(userMessage);
            
            // Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯Ú©Ø§Ø±
            setTimeout(() => {
                const botResponse = document.createElement('div');
                botResponse.className = 'flex justify-start';
                
                let answer = '';
                switch(question) {
                    case 'Ú†Ø·ÙˆØ± Ø§ÛŒØ¯Ù‡ Ø«Ø¨Øª Ú©Ù†Ù…ØŸ':
                        answer = 'Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª Ø§ÛŒØ¯Ù‡ØŒ ÙˆØ§Ø±Ø¯ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø± Ø´ÙˆÛŒØ¯ Ùˆ Ø±ÙˆÛŒ "Ø«Ø¨Øª Ø§ÛŒØ¯Ù‡ Ø¬Ø¯ÛŒØ¯" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯. ÙØ±Ù… Ø±Ø§ ØªÚ©Ù…ÛŒÙ„ Ú©Ø±Ø¯Ù‡ Ùˆ Ø§ÛŒØ¯Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø«Ø¨Øª Ú©Ù†ÛŒØ¯. ğŸ“';
                        break;
                    case 'Ú†Ø·ÙˆØ± Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù†Ù…ØŸ':
                        answer = 'Ø¯Ø± Ø¨Ø®Ø´ "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§" Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯ Ùˆ Ø±ÙˆÛŒ "Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ø§ÛŒØ¯Ù‡ Ø±Ø§ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯. ğŸ’°';
                        break;
                    case 'Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ Ú†ÛŒØ³ØªØŸ':
                        answer = 'Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ ØªØ®ØµØµÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ù†Ø¬Ø´ Ù…Ù‡Ø§Ø±Øª Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±Ø§Ù† Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ùˆ ØªÙˆØ³Ø· Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø³Ù‡ Ø³Ø·Ø­ Ù…ØªÙˆØ³Ø·ØŒ Ø®ÙˆØ¨ Ùˆ Ø¹Ø§Ù„ÛŒ Ø¯Ø§Ø±ÛŒÙ…. ğŸ“';
                        break;
                    case 'Ù†Ø­ÙˆÙ‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ú†Ú¯ÙˆÙ†Ù‡ Ø§Ø³ØªØŸ':
                        answer = 'Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ ØªÙˆÙ…Ø§Ù†/Ø¯Ù„Ø§Ø± Ùˆ Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ† Ø§Ù…Ú©Ø§Ù†â€ŒÙ¾Ø°ÛŒØ± Ø§Ø³Øª. Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø§Ù…Ù„Ø§Ù‹ Ø§Ù…Ù† Ùˆ Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª. ğŸ”’';
                        break;
                    case 'Ø§Ù…Ù†ÛŒØª Ù¾Ù„ØªÙØ±Ù… Ú†Ø·ÙˆØ± Ø§Ø³ØªØŸ':
                        answer = 'Ù¾Ù„ØªÙØ±Ù… Ù…Ø§ Ø§Ø² Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ùˆ Ù…Ø­ÙÙˆØ¸ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯. ğŸ›¡ï¸';
                        break;
                    default:
                        answer = 'Ø³ÙˆØ§Ù„ Ø¬Ø§Ù„Ø¨ÛŒ Ù¾Ø±Ø³ÛŒØ¯ÛŒØ¯! ØªÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…Ø§ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ù¾Ø§Ø³Ø® Ø®ÙˆØ§Ù‡Ø¯ Ø¯Ø§Ø¯. ğŸ¤';
                }
                
                botResponse.innerHTML = `
                    <div class="bg-blue-600 rounded-lg p-3 max-w-xs">
                        <p class="text-white text-sm">${answer}</p>
                    </div>
                `;
                messagesContainer.appendChild(botResponse);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 1000);
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function sendSupportMessage() {
            const input = document.getElementById('supportChatInput');
            const message = input.value.trim();
            
            if (message) {
                const messagesContainer = document.getElementById('supportChatMessages');
                
                // Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø±
                const userMessage = document.createElement('div');
                userMessage.className = 'flex justify-end';
                userMessage.innerHTML = `
                    <div class="bg-purple-600 rounded-lg p-3 max-w-xs">
                        <p class="text-white text-sm">${message}</p>
                    </div>
                `;
                messagesContainer.appendChild(userMessage);
                
                input.value = '';
                
                // Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯Ú©Ø§Ø±
                setTimeout(() => {
                    const botResponse = document.createElement('div');
                    botResponse.className = 'flex justify-start';
                    botResponse.innerHTML = `
                        <div class="bg-blue-600 rounded-lg p-3 max-w-xs">
                            <p class="text-white text-sm">Ù…Ù…Ù†ÙˆÙ† Ø§Ø² Ù¾ÛŒØ§Ù…ØªÙˆÙ†! ØªÛŒÙ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…Ø§ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø±Ø¯Ù‡ Ùˆ Ù¾Ø§Ø³Ø® Ø®ÙˆØ§Ù‡Ø¯ Ø¯Ø§Ø¯. ğŸ™</p>
                        </div>
                    `;
                    messagesContainer.appendChild(botResponse);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, 1500);
                
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„
        function viewOwnerProfile(ownerId) {
            const users = JSON.parse(localStorage.getItem('platformUsers')) || { ideaOwner: [], investor: [] };
            const owner = users.ideaOwner.find(u => u.id === ownerId);
            
            if (!owner) {
                alert('Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯');
                return;
            }
            
            showProfileModal(owner, 'ideaOwner');
        }
        
        function viewInvestorProfile(investorId) {
            const users = JSON.parse(localStorage.getItem('platformUsers')) || { ideaOwner: [], investor: [] };
            const investor = users.investor.find(u => u.id === investorId);
            
            if (!investor) {
                alert('Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯');
                return;
            }
            
            showProfileModal(investor, 'investor');
        }
        
        function showProfileModal(user, userType) {
            const modal = document.createElement('div');
            modal.id = 'profileViewModal';
            modal.className = 'fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50';
            
            const profile = user.profile || {};
            const medals = user.medals || [];
            
            // Ø´Ù…Ø§Ø±Ø´ Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§
            const medalCounts = {};
            medals.forEach(medal => {
                medalCounts[medal] = (medalCounts[medal] || 0) + 1;
            });
            
            const medalIcons = { bronze: 'ğŸ¥‰', silver: 'ğŸ¥ˆ', gold: 'ğŸ¥‡' };
            const medalNames = { bronze: 'Ø¨Ø±Ù†Ø²', silver: 'Ù†Ù‚Ø±Ù‡', gold: 'Ø·Ù„Ø§' };
            
            const medalsHtml = Object.keys(medalCounts).length > 0 ? 
                Object.keys(medalCounts).map(medal => 
                    `<div class="flex items-center gap-1 bg-gray-700 px-2 py-1 rounded-full text-sm">
                        <span>${medalIcons[medal]}</span>
                        <span class="text-white">${medalNames[medal]}</span>
                        ${medalCounts[medal] > 1 ? `<span class="bg-red-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">${medalCounts[medal]}</span>` : ''}
                    </div>`
                ).join('') : '<span class="text-gray-400 text-sm">Ù‡Ù†ÙˆØ² Ù…Ø¯Ø§Ù„ÛŒ Ú©Ø³Ø¨ Ù†Ú©Ø±Ø¯Ù‡</span>';
            
            if (userType === 'ideaOwner') {
                modal.innerHTML = `
                    <div class="bg-gray-800 rounded-xl p-8 max-w-md w-full border border-purple-500/30">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-purple-300">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±</h3>
                            <button onclick="closeProfileViewModal()" class="text-gray-400 hover:text-white text-2xl">âœ•</button>
                        </div>
                        
                        <div class="text-center mb-6">
                            <div class="relative w-24 h-24 mx-auto mb-4">
                                <div class="w-24 h-24 bg-gray-600 rounded-full flex items-center justify-center">
                                    <span class="text-3xl">ğŸ‘¤</span>
                                </div>
                                <div class="absolute -top-1 -right-1 flex flex-wrap gap-1">
                                    ${Object.keys(medalCounts).map(medal => 
                                        `<div class="relative">
                                            <span class="text-sm">${medalIcons[medal]}</span>
                                            ${medalCounts[medal] > 1 ? `<span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-3 h-3 flex items-center justify-center text-[8px]">${medalCounts[medal]}</span>` : ''}
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                            <h4 class="text-xl font-bold text-white">${user.name}</h4>
                            <p class="text-purple-300">${profile.specialty || 'Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±'}</p>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <span class="text-gray-400 text-sm">Ø´Ù‡Ø±:</span>
                                    <p class="text-white">${profile.city || '-'}</p>
                                </div>
                                <div>
                                    <span class="text-gray-400 text-sm">Ø³Ø§Ø¨Ù‚Ù‡:</span>
                                    <p class="text-white">${profile.experience ? profile.experience + ' Ø³Ø§Ù„' : '-'}</p>
                                </div>
                            </div>
                            
                            <div>
                                <span class="text-gray-400 text-sm">Ø¯Ø±Ø¨Ø§Ø±Ù‡:</span>
                                <p class="text-white text-sm mt-1">${profile.bio || 'Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡'}</p>
                            </div>
                            
                            <div>
                                <span class="text-gray-400 text-sm">Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ú©Ø³Ø¨ Ø´Ø¯Ù‡:</span>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    ${medalsHtml}
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="closeProfileViewModal()" class="w-full mt-6 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg transition-colors">
                            Ø¨Ø³ØªÙ†
                        </button>
                    </div>
                `;
            } else {
                modal.innerHTML = `
                    <div class="bg-gray-800 rounded-xl p-8 max-w-md w-full border border-blue-500/30">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-blue-300">Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±</h3>
                            <button onclick="closeProfileViewModal()" class="text-gray-400 hover:text-white text-2xl">âœ•</button>
                        </div>
                        
                        <div class="text-center mb-6">
                            <div class="w-24 h-24 mx-auto mb-4 bg-gray-600 rounded-full flex items-center justify-center">
                                <span class="text-3xl">ğŸ‘¤</span>
                            </div>
                            <h4 class="text-xl font-bold text-white">${user.name}</h4>
                            <p class="text-blue-300">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±</p>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <span class="text-gray-400 text-sm">Ø´Ù‡Ø±:</span>
                                    <p class="text-white">${profile.city || '-'}</p>
                                </div>
                                <div>
                                    <span class="text-gray-400 text-sm">Ø¨ÙˆØ¯Ø¬Ù‡:</span>
                                    <p class="text-white">${profile.budget || '-'}</p>
                                </div>
                            </div>
                            
                            <div>
                                <span class="text-gray-400 text-sm">Ø¹Ù„Ø§ÛŒÙ‚ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ:</span>
                                <p class="text-white text-sm mt-1">${profile.interests || 'Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡'}</p>
                            </div>
                        </div>
                        
                        <button onclick="closeProfileViewModal()" class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-colors">
                            Ø¨Ø³ØªÙ†
                        </button>
                    </div>
                `;
            }
            
            document.body.appendChild(modal);
        }
        
        function closeProfileViewModal() {
            const modal = document.getElementById('profileViewModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±ÙˆØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ - ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª
        function checkAutoLogin() {
            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‚Ø¨Ù„ÛŒ Ùˆ Ø­ÙØ¸ Ø¢Ù†â€ŒÙ‡Ø§
            const existingUsers = JSON.parse(localStorage.getItem('platformUsers'));
            if (!existingUsers) {
                // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ØŒ Ø³Ø§Ø®ØªØ§Ø± Ø§ÙˆÙ„ÛŒÙ‡ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†
                localStorage.setItem('platformUsers', JSON.stringify({ ideaOwner: [], investor: [] }));
            }
            
            // Ø¹Ø¯Ù… ÙˆØ±ÙˆØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± - Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ù‡Ø± Ø¨Ø§Ø± Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø±Ù…Ø² ÙˆØ§Ø±Ø¯ Ú©Ù†Ø¯
            // Ø§Ù…Ø§ ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± localStorage Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯
            clearUserSession();
            return false;
        }
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±
        function saveUserSession() {
            try {
                if (currentUser && currentUserType) {
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    localStorage.setItem('currentUserType', currentUserType);
                }
            } catch (error) {
                console.error('Error saving user session:', error);
            }
        }
        
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¬Ù„Ø³Ù‡
        function clearUserSession() {
            try {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('currentUserType');
                currentUser = null;
                currentUserType = null;
            } catch (error) {
                console.error('Error clearing user session:', error);
            }
        }
        
        // ØªÙˆØ§Ø¨Ø¹ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ú†Øª
        function showChatNotification(userType) {
            const notificationId = userType === 'ideaOwner' ? 'ideaOwnerChatNotification' : 'investorChatNotification';
            const notification = document.getElementById(notificationId);
            if (notification) {
                notification.classList.remove('hidden');
            }
        }
        
        function hideChatNotification(userType) {
            const notificationId = userType === 'ideaOwner' ? 'ideaOwnerChatNotification' : 'investorChatNotification';
            const notification = document.getElementById(notificationId);
            if (notification) {
                notification.classList.add('hidden');
            }
        }
        
        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ø§ Enter
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ±ÙˆØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±
                if (!checkAutoLogin()) {
                    showLoginPage();
                }
                
                // ØªØ§Ø®ÛŒØ± Ú©ÙˆØªØ§Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ DOM
                setTimeout(() => {
                    // ÙØ±Ù… ÙˆØ±ÙˆØ¯
                    const loginEmail = document.getElementById('loginEmail');
                    const loginPassword = document.getElementById('loginPassword');
                    if (loginEmail && loginPassword) {
                        [loginEmail, loginPassword].forEach(input => {
                            input.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter') {
                                    processLogin();
                                }
                            });
                        });
                    }
                    
                    // ÙØ±Ù… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…
                    const registerInputs = ['registerName', 'registerEmail', 'registerPassword', 'registerConfirmPassword'];
                    registerInputs.forEach(inputId => {
                        const input = document.getElementById(inputId);
                        if (input) {
                            input.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter') {
                                    processRegister();
                                }
                            });
                        }
                    });
                    
                    // Ú†Øª Ø§ÛŒØ¯Ù‡â€ŒØ¯Ø§Ø±
                    const ideaOwnerChatInput = document.getElementById('ideaOwnerChatInput');
                    if (ideaOwnerChatInput) {
                        ideaOwnerChatInput.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter' && !this.disabled) {
                                sendIdeaOwnerMessage();
                            }
                        });
                    }
                    
                    // Ú†Øª Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±
                    const investorChatInput = document.getElementById('investorChatInput');
                    if (investorChatInput) {
                        investorChatInput.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter' && !this.disabled) {
                                sendInvestorMessage();
                            }
                        });
                    }
                    
                    // Ú†Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
                    const supportChatInput = document.getElementById('supportChatInput');
                    if (supportChatInput) {
                        supportChatInput.addEventListener('keypress', function(e) {
                            if (e.key === 'Enter') {
                                sendSupportMessage();
                            }
                        });
                    }
                }, 100);
            } catch (error) {
                console.error('Error in DOMContentLoaded:', error);
                // Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ø­Ø¯Ø§Ù‚Ù„ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
                showLoginPage();
            }
        });
